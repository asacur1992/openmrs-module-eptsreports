package org.openmrs.module.eptsreports.reporting.library.queries;

public interface TXMLQueriesInterface {

  public class QUERY {

    public static final String findPatientsWhoAreDeadByTheEndOfReportingPeriod =
        ""
            + "select all_dead.patient_id         "
            + "from                "
            + "(                   "
            + "    select patient_id,max(data_estado) data_estado                    "
            + "    from            "
            + "     (              "
            + "        select distinct max_estado.patient_id, max_estado.data_estado "
            + "        from        "
            + "        (           "
            + "            select  pg.patient_id, max(ps.start_date) data_estado     "
            + "                from patient p     "
            + "                    inner join person pe on pe.person_id = p.patient_id                     "
            + "                    inner join patient_program pg on p.patient_id = pg.patient_id           "
            + "                    inner join patient_state ps on pg.patient_program_id = ps.patient_program_id           "
            + "                where pg.voided=0 and ps.voided=0 and p.voided=0 and pe.voided = 0 and pg.program_id = 2   "
            + "                    and ps.start_date<= :endDate and pg.location_id =:location group by pg.patient_id      "
            + "         ) max_estado              "
            + "                inner join patient_program pp on pp.patient_id = max_estado.patient_id      "
            + "                inner join patient_state ps on ps.patient_program_id = pp.patient_program_id and ps.start_date = max_estado.data_estado       "
            + "            where pp.program_id = 2 and ps.state = 10 and pp.voided = 0 and ps.voided = 0 and pp.location_id = :location                      "
            + "                    "
            + "         union      "
            + "                    "
            + "         select  p.patient_id,max(o.obs_datetime) data_estado         "
            + "         from   patient p          "
            + "                inner join person pe on pe.person_id = p.patient_id   "
            + "               inner join encounter e on p.patient_id=e.patient_id    "
            + "               inner join obs  o on e.encounter_id=o.encounter_id     "
            + "         where  e.voided=0 and o.voided=0 and p.voided=0 and pe.voided = 0                  "
            + "               and e.encounter_type in (53,6) and o.concept_id in (6272,6273) and o.value_coded = 1366     "
            + "                and o.obs_datetime<=:endDate and e.location_id=:location                    "
            + "                group by p.patient_id                                 "
            + "                    "
            + "         union      "
            + "                    "
            + "         select person_id as patient_id,death_date as data_estado     "
            + "         from person"
            + "         where dead=1 and voided = 0 and death_date is not null and death_date<=:endDate    "
            + "                    "
            + "         union      "
            + "                    "
            + "         select p.patient_id, max(obsObito.obs_datetime) data_estado  "
            + "         from patient p            "
            + "                inner join person pe on pe.person_id = p.patient_id   "
            + "               inner join encounter e on p.patient_id=e.patient_id    "
            + "               inner join obs obsObito on e.encounter_id=obsObito.encounter_id              "
            + "         where e.voided=0 and p.voided=0 and pe.voided = 0 and obsObito.voided=0            "
            + "                and e.encounter_type in (21,36,37) and  e.encounter_datetime<=:endDate and  e.location_id=:location                           "
            + "               and obsObito.concept_id in (2031,23944,23945) and obsObito.value_coded=1366  "
            + "                group by p.patient_id                                 "
            + "       ) all_dead   "
            + " group by patient_id"
            + ") all_dead          "
            + "left join           "
            + "(                   "
            + "    select patient_id,max(max_date) max_date                          "
            + "    from            "
            + "    (               "
            + "            Select p.patient_id,max(encounter_datetime) max_date      "
            + "            from    patient p      "
            + "                    inner join person pe on pe.person_id = p.patient_id                     "
            + "                    inner join encounter e on e.patient_id=p.patient_id                     "
            + "            where   p.voided=0 and pe.voided = 0 and e.voided=0 and e.encounter_type=18     "
            + "                    and e.location_id= :location and e.encounter_datetime <= :endDate                     "
            + "                group by p.patient_id                                 "
            + "                    "
            + "            union   "
            + "                    "
            + "            Select p.patient_id,max(encounter_datetime) max_date      "
            + "            from  patient p        "
            + "                    inner join person pe on pe.person_id = p.patient_id                     "
            + "                    inner join encounter e on e.patient_id=p.patient_id                     "
            + "            where p.voided=0 and pe.voided = 0 and e.voided=0 and e.encounter_type in (6,9) "
            + "                    and e.location_id= :location and e.encounter_datetime <= :endDate                     "
            + "                group by p.patient_id                                 "
            + "                    "
            + "    ) last_encounter group  by patient_id                             "
            + "                    "
            + ") last_encounter on all_dead.patient_id  = last_encounter.patient_id  "
            + "where all_dead.data_estado >= last_encounter.max_date                 ";

    public static final String findPatiensWhoStoppedOrRefusedTreatmentByTheEndOfReportingDate =
        "          "
            + "select all_stopped_treatment.patient_id                               "
            + "from                "
            + "(                   "
            + "    select patient_id,max(data_estado) data_estado                    "
            + "    from            "
            + "     (              "
            + "        select distinct max_estado.patient_id, max_estado.data_estado "
            + "        from        "
            + "        (           "
            + "            select  pg.patient_id, max(ps.start_date) data_estado     "
            + "                from patient p     "
            + "                    inner join person pe on pe.person_id = p.patient_id                     "
            + "                    inner join patient_program pg on p.patient_id = pg.patient_id           "
            + "                    inner join patient_state ps on pg.patient_program_id = ps.patient_program_id           "
            + "                where pg.voided=0 and ps.voided=0 and p.voided=0 and pe.voided = 0 and pg.program_id = 2   "
            + "                    and ps.start_date<= :endDate and pg.location_id =:location group by pg.patient_id      "
            + "         ) max_estado              "
            + "                inner join patient_program pp on pp.patient_id = max_estado.patient_id      "
            + "                inner join patient_state ps on ps.patient_program_id = pp.patient_program_id and ps.start_date = max_estado.data_estado       "
            + "            where pp.program_id = 2 and ps.state = 8 and pp.voided = 0 and ps.voided = 0 and pp.location_id = :location                       "
            + "                    "
            + "         union      "
            + "                    "
            + "         select  p.patient_id,max(o.obs_datetime) data_estado         "
            + "         from   patient p          "
            + "                inner join person pe on pe.person_id = p.patient_id   "
            + "               inner join encounter e on p.patient_id=e.patient_id    "
            + "               inner join obs  o on e.encounter_id=o.encounter_id     "
            + "         where  e.voided=0 and o.voided=0 and p.voided=0 and pe.voided = 0                  "
            + "               and e.encounter_type in (53,6) and o.concept_id in (6272,6273) and o.value_coded = 1709     "
            + "                and o.obs_datetime<=:endDate and e.location_id=:location                    "
            + "                group by p.patient_id                                 "
            + "                    "
            + "       ) all_stopped_treatment     "
            + " group by patient_id"
            + ") all_stopped_treatment            "
            + "left join           "
            + "  (                 "
            + "    select patient_id,max(max_date) max_date                          "
            + "    from            "
            + "      (             "
            + "            Select p.patient_id,max(encounter_datetime) max_date      "
            + "            from    patient p      "
            + "                    inner join person pe on pe.person_id = p.patient_id                     "
            + "                    inner join encounter e on e.patient_id=p.patient_id                     "
            + "            where   p.voided=0 and pe.voided = 0 and e.voided=0 and e.encounter_type=18     "
            + "                    and e.location_id= :location and e.encounter_datetime <= :endDate                     "
            + "                group by p.patient_id                                 "
            + "                    "
            + "            union   "
            + "                    "
            + "            Select p.patient_id,max(encounter_datetime) max_date      "
            + "            from  patient p        "
            + "                    inner join person pe on pe.person_id = p.patient_id                     "
            + "                    inner join encounter e on e.patient_id=p.patient_id                     "
            + "            where p.voided=0 and pe.voided = 0 and e.voided=0 and e.encounter_type in (6,9) "
            + "                    and e.location_id= :location and e.encounter_datetime <= :endDate                     "
            + "                group by p.patient_id                                 "
            + "                    "
            + "    ) last_encounter group  by patient_id                             "
            + "                    "
            + ") last_encounter on all_stopped_treatment.patient_id  = last_encounter.patient_id           "
            + "where all_stopped_treatment.data_estado >= last_encounter.max_date    ";
  }
}
