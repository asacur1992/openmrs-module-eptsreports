package org.openmrs.module.eptsreports.reporting.library.queries;

import org.openmrs.module.eptsreports.reporting.library.queries.TxTbPrevQueriesInterface.QUERY.DisaggregationTypes;

public interface TPTCompletationQueries {

  class QUERY {

    public static final String findPatientsWhoStartedINHTherapyBeforeReportingEndDate =
        "																"
            + "select distinct inicio_inh.patient_id from																								"
            + " ( 																																		"
            + " 	select p.patient_id, o.value_datetime data_inicio_inh 																				"
            + " 		from patient p 																													"
            + " 			inner join encounter e on p.patient_id=e.patient_id 																		"
            + " 			inner join obs o on o.encounter_id=e.encounter_id 																			"
            + " 		where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128  						"
            + " 			and o.value_datetime < :endDate and e.location_id=:location 																"
            + "    union																																"
            + " 	select p.patient_id, e.encounter_datetime data_inicio_inh 																			"
            + " 		from	patient p 																												"
            + " 			inner join encounter e on p.patient_id=e.patient_id 																		"
            + " 			inner join obs o on o.encounter_id=e.encounter_id 																			"
            + " 		where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256 		"
            + " 			and e.encounter_datetime < :endDate and e.location_id=:location 															"
            + " 	union 																																"
            + " 	select p.patient_id, e.encounter_datetime data_inicio_inh from patient p															"
            + " 		inner join encounter e on p.patient_id=e.patient_id																				"
            + "    	inner join obs o on o.encounter_id=e.encounter_id																					"
            + "    where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 		"
            + "    	and e.encounter_datetime < :endDate and e.location_id=:location	 																	"
            + ") inicio_inh 																															";

    public static final String findPatientsWhoCompletedINHTherapy =
        "                                                                            					"
            + "	select inicio_inh.patient_id from 																													"
            + "					( 																																	"
            + "						select p.patient_id, o.value_datetime data_inicio_inh 																			"
            + "							from	patient p 																									    	"
            + "								inner join encounter e on p.patient_id=e.patient_id 																	"
            + "								inner join obs o on o.encounter_id=e.encounter_id 																		"
            + "							where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128 					"
            + "								and o.value_datetime < :endDate and e.location_id=:location 															"
            + "						union 																															"
            + "						select p.patient_id, e.encounter_datetime data_inicio_inh 																		"
            + "							from patient p 																												"
            + "								inner join encounter e on p.patient_id=e.patient_id 																	"
            + "								inner join obs o on o.encounter_id=e.encounter_id 																		"
            + "							where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256  "
            + "								and e.encounter_datetime < :endDate and e.location_id=:location 														"
            + "						union 																															"
            + "             				select p.patient_id, e.encounter_datetime data_inicio_inh from patient p												"
            + "             					inner join encounter e on p.patient_id=e.patient_id																	"
            + "                				inner join obs o on o.encounter_id=e.encounter_id																		"
            + "                			where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 "
            + "                				and e.encounter_datetime < :endDate and e.location_id=:location 														"
            + "					) inicio_inh 																														"
            + "					inner join 																															"
            + "					(	select patient_id, data_final_inh 																								"
            + "						from( 																															"
            + "							select p.patient_id, o.value_datetime data_final_inh 																		"
            + "							from patient p 																												"
            + "								inner join encounter e on p.patient_id=e.patient_id 																	"
            + "								inner join obs o on o.encounter_id=e.encounter_id 																		"
            + "							where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6129 						"
            + "								and o.value_datetime <= :endDate and e.location_id=:location 															"
            + "							union																														"
            + "							select p.patient_id, e.encounter_datetime data_final_inh 																	"
            + "							from patient p 																												"
            + "									inner join encounter e on p.patient_id=e.patient_id 																"
            + "									inner join obs o on o.encounter_id=e.encounter_id 																	"
            + "							where 	p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=6 and o.concept_id=6122 and o.value_coded=1267 		"
            + "									and e.encounter_datetime<= :endDate and e.location_id=:location 													"
            + "						) endINH 																														"
            + "					) termino_inh on inicio_inh.patient_id=termino_inh.patient_id 																		"
            + "					where termino_inh.data_final_inh between  inicio_inh.data_inicio_inh + interval 173 day and inicio_inh.data_inicio_inh + interval 365 day													"
            + "					union 																																"
            + "					select inicio_inh.patient_id from 																									"
            + "					( 																																	"
            + "						select p.patient_id, o.value_datetime data_inicio_inh 																			"
            + "							from	patient p 																											"
            + "								inner join encounter e on p.patient_id=e.patient_id 																	"
            + "								inner join obs o on o.encounter_id=e.encounter_id 																		"
            + "							where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128 					"
            + "								and o.value_datetime < :endDate and e.location_id=:location 															"
            + "						union 																															"
            + "						select p.patient_id, e.encounter_datetime data_inicio_inh 																		"
            + "							from	patient p 																											"
            + "								inner join encounter e on p.patient_id=e.patient_id 																	"
            + "								inner join obs o on o.encounter_id=e.encounter_id 																		"
            + "							where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256  "
            + "								and e.encounter_datetime < :endDate and e.location_id=:location 														"
            + "							union 																														"
            + "             					select p.patient_id, e.encounter_datetime data_inicio_inh from patient p											"
            + "             						inner join encounter e on p.patient_id=e.patient_id																"
            + "                					inner join obs o on o.encounter_id=e.encounter_id																	"
            + "                				where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 "
            + "                					and e.encounter_datetime < :endDate and e.location_id=:location  													"
            + "					) inicio_inh 																														"
            + "					inner join encounter e on e.patient_id=inicio_inh.patient_id 																		"
            + "					inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id 																	"
            + "					left join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id and obsDTINH.voided=0 												"
            + "							and obsDTINH.concept_id=1719 and obsDTINH.value_coded=23955 																"
            + "							and obsDTINH.obs_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH) 			"
            + "					where e.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (6,9) and obsLevTPI.concept_id=6122 and obsLevTPI.value_coded in (1257,1065,1256) "
            + "						and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH) 				"
            + "						and obsDTINH.concept_id is null and e.location_id=:location 																	"
            + "						group by inicio_inh.patient_id, e.encounter_datetime having count(*)>=6 													"
            + "					union 																																"
            + "					select inicio_inh.patient_id from 																									"
            + "					( 																																	"
            + "						select p.patient_id, o.value_datetime data_inicio_inh 																			"
            + "							from	patient p 																											"
            + "								inner join encounter e on p.patient_id=e.patient_id 																	"
            + "								inner join obs o on o.encounter_id=e.encounter_id 																		"
            + "							where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128 					"
            + "								and o.value_datetime < :endDate and e.location_id=:location 															"
            + "						union 																															"
            + "						select p.patient_id, e.encounter_datetime data_inicio_inh 																		"
            + "							from	patient p 																											"
            + "								inner join encounter e on p.patient_id=e.patient_id 																	"
            + "								inner join obs o on o.encounter_id=e.encounter_id 																		"
            + "							where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256  "
            + "								and e.encounter_datetime < :endDate and e.location_id=:location 														"
            + "						union 																															"
            + "             				select p.patient_id, e.encounter_datetime data_inicio_inh from patient p												"
            + "             					inner join encounter e on p.patient_id=e.patient_id																	"
            + "                				inner join obs o on o.encounter_id=e.encounter_id																		"
            + "                			where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 "
            + "                				and e.encounter_datetime < :endDate and e.location_id=:location 														"
            + "					) inicio_inh 																														"
            + "					inner join encounter e on e.patient_id=inicio_inh.patient_id 																		"
            + "					inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id 																	"
            + "					inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id and obsDTINH.voided=0 												"
            + "					where e.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (6,9) and obsLevTPI.concept_id=6122 and obsLevTPI.value_coded in (1257,1065,1256) "
            + "						and obsDTINH.concept_id=1719 and obsDTINH.value_coded=23955 																	"
            + "						and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 5 MONTH) and e.location_id=:location "
            + "						group by inicio_inh.patient_id, e.encounter_datetime having count(*)>=2 													"
            + "					union 																																"
            + "					select inicio_inh.patient_id from 																									"
            + "					( 																																	"
            + "						select inicio_inh.patient_id from 																								"
            + "						(																																"
            + "							select p.patient_id, o.value_datetime data_inicio_inh 																		"
            + "								from	patient p 																										"
            + "									inner join encounter e on p.patient_id=e.patient_id 																"
            + "									inner join obs o on o.encounter_id=e.encounter_id 																	"
            + "								where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128 				"
            + "									and o.value_datetime < :endDate and e.location_id=:location 														"
            + "							union 																														"
            + "							select p.patient_id, e.encounter_datetime data_inicio_inh 																	"
            + "								from	patient p 																										"
            + "									inner join encounter e on p.patient_id=e.patient_id 																"
            + "									inner join obs o on o.encounter_id=e.encounter_id 																	"
            + "								where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256  "
            + "									and e.encounter_datetime < :endDate and e.location_id=:location  													"
            + "							union 																														"
            + "             					select p.patient_id, e.encounter_datetime data_inicio_inh from patient p											"
            + "             						inner join encounter e on p.patient_id=e.patient_id																"
            + "                					inner join obs o on o.encounter_id=e.encounter_id																	"
            + "                				where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 "
            + "                					and e.encounter_datetime < :endDate and e.location_id=:location  													"
            + "						) inicio_inh 																													"
            + "						inner join encounter e on e.patient_id=inicio_inh.patient_id 																	"
            + "						inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id 																"
            + "						left join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id and obsDTINH.voided=0 											"
            + "								and obsDTINH.concept_id=1719 and obsDTINH.value_coded=23955 															"
            + "								and obsDTINH.obs_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH) 		"
            + "						where e.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (6,9) and obsLevTPI.concept_id=6122 and obsLevTPI.value_coded in (1257,1065,1256) "
            + "							and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH)  			"
            + "							and obsDTINH.concept_id is null and e.location_id=:location 																"
            + "							group by inicio_inh.patient_id, e.encounter_datetime having count(*)>=3 												"
            + "					) inicio_inh 																														"
            + "					inner join 																															"
            + "					( 																																	"
            + "						select inicio_inh.patient_id from 																								"
            + "						( 																																"
            + "							select p.patient_id, o.value_datetime data_inicio_inh 																		"
            + "								from	patient p 																										"
            + "									inner join encounter e on p.patient_id=e.patient_id 																"
            + "									inner join obs o on o.encounter_id=e.encounter_id 																	"
            + "								where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128 				"
            + "									and o.value_datetime < :endDate and e.location_id=:location 														"
            + "							union 																														"
            + "							select p.patient_id, e.encounter_datetime data_inicio_inh 																	"
            + "								from	patient p 																										"
            + "									inner join encounter e on p.patient_id=e.patient_id 																"
            + "									inner join obs o on o.encounter_id=e.encounter_id 																	"
            + "								where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256  "
            + "									and e.encounter_datetime < :endDate and e.location_id=:location 													"
            + "							union 																														"
            + "							select p.patient_id, e.encounter_datetime data_inicio_inh from patient p													"
            + "             						inner join encounter e on p.patient_id=e.patient_id																"
            + "                					inner join obs o on o.encounter_id=e.encounter_id																	"
            + "                				where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 "
            + "                					and e.encounter_datetime < :endDate and e.location_id=:location 													"
            + "						) inicio_inh 																													"
            + "						inner join encounter e on e.patient_id=inicio_inh.patient_id 																	"
            + "						inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id 																"
            + "						inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id and obsDTINH.voided=0 											"
            + "						where e.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (6,9) and obsLevTPI.concept_id=6122 and obsLevTPI.value_coded in (1257,1065,1256) "
            + "							and obsDTINH.concept_id=1719 and obsDTINH.value_coded=23955 																"
            + "							and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH) and e.location_id=:location "
            + "							group by inicio_inh.patient_id, e.encounter_datetime having count(*)>=1 												"
            + "					) inicio_inh_dt on inicio_inh_dt.patient_id = inicio_inh.patient_id 																"
            + "					union 																																"
            + "					select inicio_inh.patient_id from 																									"
            + "					( 																																	"
            + "						select p.patient_id, o.value_datetime data_inicio_inh 																			"
            + "							from	patient p 																											"
            + "								inner join encounter e on p.patient_id=e.patient_id 																	"
            + "								inner join obs o on o.encounter_id=e.encounter_id 																		"
            + "							where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128 					"
            + "								and o.value_datetime < :endDate and e.location_id=:location 															"
            + "						union 																															"
            + "						select p.patient_id, e.encounter_datetime data_inicio_inh 																		"
            + "							from	patient p 																											"
            + "								inner join encounter e on p.patient_id=e.patient_id 																	"
            + "								inner join obs o on o.encounter_id=e.encounter_id 																		"
            + "							where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256  "
            + "								and e.encounter_datetime < :endDate and e.location_id=:location 														"
            + "					 	union 																															"
            + "					 	select p.patient_id, e.encounter_datetime data_inicio_inh from patient p														"
            + "             					inner join encounter e on p.patient_id=e.patient_id																	"
            + "                				inner join obs o on o.encounter_id=e.encounter_id																		"
            + "                			where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 "
            + "                				and e.encounter_datetime < :endDate and e.location_id=:location 														"
            + "					) inicio_inh 																														"
            + "					inner join encounter e on e.patient_id=inicio_inh.patient_id 																		"
            + "					inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id 																	"
            + "					inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id 																	"
            + "					where e.voided=0 and obsDTINH.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (60) 											"
            + "						and obsDTINH.concept_id=23986 and obsDTINH.value_coded=1098  and obsLevTPI.concept_id=23985 and obsLevTPI.value_coded in (656,23982) "
            + "						and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH) and e.location_id=:location "
            + "						group by inicio_inh.patient_id, e.encounter_datetime having count(*)>=6 													"
            + "					union 																																"
            + "					select inicio_inh.patient_id from 																									"
            + "					( 																																	"
            + "						select p.patient_id, o.value_datetime data_inicio_inh 																			"
            + "							from	patient p 																											"
            + "								inner join encounter e on p.patient_id=e.patient_id 																	"
            + "								inner join obs o on o.encounter_id=e.encounter_id 																		"
            + "							where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128 					"
            + "								and o.value_datetime < :endDate and e.location_id=:location 															"
            + "						union 																															"
            + "						select p.patient_id, e.encounter_datetime data_inicio_inh 																		"
            + "							from	patient p 																											"
            + "								inner join encounter e on p.patient_id=e.patient_id 																	"
            + "								inner join obs o on o.encounter_id=e.encounter_id 																		"
            + "							where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256  "
            + "								and e.encounter_datetime < :endDate and e.location_id=:location 														"
            + "						union 																															"
            + "             				select p.patient_id, e.encounter_datetime data_inicio_inh from patient p												"
            + "             					inner join encounter e on p.patient_id=e.patient_id																	"
            + "                				inner join obs o on o.encounter_id=e.encounter_id																		"
            + "                			where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 "
            + "                				and e.encounter_datetime < :endDate and e.location_id=:location   														"
            + "					) inicio_inh 																														"
            + "					inner join encounter e on e.patient_id=inicio_inh.patient_id 																		"
            + "					inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id 																	"
            + "					inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id 																	"
            + "					where e.voided=0 and obsDTINH.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (60) 											"
            + "						and obsDTINH.concept_id=23986 and obsDTINH.value_coded=23720  and obsLevTPI.concept_id=23985 and obsLevTPI.value_coded in (656,23982) "
            + "						and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 5 MONTH) and e.location_id=:location "
            + "						group by inicio_inh.patient_id, e.encounter_datetime having count(*)>=2 													"
            + "					union 																																"
            + "					select inicio_inh.patient_id from 																									"
            + "					( 																																	"
            + "						select inicio_inh.patient_id from 																								"
            + "						( 																																"
            + "							select p.patient_id, o.value_datetime data_inicio_inh 																		"
            + "								from	patient p 																										"
            + "									inner join encounter e on p.patient_id=e.patient_id 																"
            + "									inner join obs o on o.encounter_id=e.encounter_id 																	"
            + "								where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128 				"
            + "									and o.value_datetime < :endDate and e.location_id=:location 														"
            + "							union 																														"
            + "							select p.patient_id, e.encounter_datetime data_inicio_inh 																	"
            + "								from	patient p 																										"
            + "									inner join encounter e on p.patient_id=e.patient_id 																"
            + "									inner join obs o on o.encounter_id=e.encounter_id 																	"
            + "								where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256  "
            + "									and e.encounter_datetime < :endDate and e.location_id=:location 													"
            + "							union 																														"
            + "             					select p.patient_id, e.encounter_datetime data_inicio_inh from patient p											"
            + "             						inner join encounter e on p.patient_id=e.patient_id																"
            + "                					inner join obs o on o.encounter_id=e.encounter_id																	"
            + "                				where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 "
            + "                					and e.encounter_datetime < :endDate and e.location_id=:location  													"
            + "						) inicio_inh 																													"
            + "						inner join encounter e on e.patient_id=inicio_inh.patient_id 																	"
            + "						inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id 																"
            + "						inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id 																"
            + "						where e.voided=0 and obsDTINH.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (60) 										"
            + "							and obsDTINH.concept_id=23986 and obsDTINH.value_coded=1098  and obsLevTPI.concept_id=23985 and obsLevTPI.value_coded in (656,23982) "
            + "							and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH) and e.location_id=:location "
            + "							group by inicio_inh.patient_id, e.encounter_datetime having count(*)>=3												"
            + "					) inicio_inh 																														"
            + "					inner join 																															"
            + "					( 																																	"
            + "						select inicio_inh.patient_id from 																								"
            + "						( 																																"
            + "							select p.patient_id, o.value_datetime data_inicio_inh 																		"
            + "								from	patient p 																										"
            + "									inner join encounter e on p.patient_id=e.patient_id																	"
            + "									inner join obs o on o.encounter_id=e.encounter_id 																	"
            + "								where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128 				"
            + "									and o.value_datetime < :endDate and e.location_id=:location 														"
            + "							union 																														"
            + "							select p.patient_id, e.encounter_datetime data_inicio_inh 																	"
            + "								from	patient p 																										"
            + "									inner join encounter e on p.patient_id=e.patient_id 																"
            + "									inner join obs o on o.encounter_id=e.encounter_id 																	"
            + "								where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256  "
            + "									and e.encounter_datetime < :endDate and e.location_id=:location 													"
            + "							union 																														"
            + "             					select p.patient_id, e.encounter_datetime data_inicio_inh from patient p											"
            + "             						inner join encounter e on p.patient_id=e.patient_id																"
            + "                					inner join obs o on o.encounter_id=e.encounter_id																	"
            + "                				where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 "
            + "                					and e.encounter_datetime < :endDate and e.location_id=:location  													"
            + "						) inicio_inh 																													"
            + "						inner join encounter e on e.patient_id=inicio_inh.patient_id																	"
            + "						inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id 																"
            + "						inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id 																"
            + "						where e.voided=0 and obsDTINH.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (60) 										"
            + "							and obsDTINH.concept_id=23986 and obsDTINH.value_coded=23720  and obsLevTPI.concept_id=23985 and obsLevTPI.value_coded in (656,23982) "
            + "							and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH) and e.location_id=:location "
            + "							group by inicio_inh.patient_id, e.encounter_datetime having count(*)>=1   											      	"
            + "				 ) inicio_inh_dt on inicio_inh_dt.patient_id = inicio_inh.patient_id 																	";

    public static final String findPatientsWhoStarted3HPTherapyBeforeReportingEndDate =
        "															"
            + "select patient_id from																												"
            + "(																																	"
            + "	select p.patient_id, e.encounter_datetime data_inicio_3HP																			"
            + "		from	patient p																												"
            + "			inner join encounter e on p.patient_id=e.patient_id																			"
            + "			inner join obs o on o.encounter_id=e.encounter_id																			"
            + "		where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9) and o.concept_id=1719 and o.value_coded=23954 		"
            + "			and e.encounter_datetime < :endDate and e.location_id= :location															"
            + "	union																																"
            + "	select p.patient_id, e.encounter_datetime data_inicio_3HP																			"
            + "		from	patient p																												"
            + "			inner join encounter e on p.patient_id=e.patient_id																			"
            + "			inner join obs o on o.encounter_id=e.encounter_id																			"
            + "		where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=60  and o.concept_id=23985 and o.value_coded in (23954,23984) "
            + "			and	e.encounter_datetime < :endDate and e.location_id= :location															"
            + ") inicio_3HP																															";

    public static final String findPatientsWhoCompleted3HPTherapy =
        "																								"
            + "select inicio_3HP.patient_id 																																"
            + "from (                                                                                                                                                    "
            + "		select p.patient_id, e.encounter_datetime data_inicio_3HP from patient p                                                                            "
            + "			inner join encounter e on p.patient_id=e.patient_id                                                                                        		"
            + "			inner join obs o on o.encounter_id=e.encounter_id                                                                                        		"
            + "		where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9) and o.concept_id=1719 and o.value_coded=23954                     		"
            + "			and e.encounter_datetime < :endDate and e.location_id= :location                                                                        		"
            + "		union                                                                                                                                            	"
            + "		select p.patient_id, e.encounter_datetime data_inicio_3HP from patient p                                                                            "
            + "			inner join encounter e on p.patient_id=e.patient_id                                                                                        		"
            + "			inner join obs o on o.encounter_id=e.encounter_id                                                                                        		"
            + "		where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=60  and o.concept_id=23985 and o.value_coded in (23954,23984)              		"
            + "			and e.encounter_datetime < :endDate and e.location_id= :location                                                                        		"
            + "	) inicio_3HP                                                                                                                                        	"
            + "	inner join encounter e on e.patient_id=inicio_3HP.patient_id                                                                                        	"
            + "	inner join obs o on o.encounter_id=e.encounter_id                                                                                                    	"
            + "	where e.voided=0 and o.voided=0 and e.encounter_type in (6,9) and o.concept_id=1719 and o.value_coded=23954                                          	"
            + "		and e.encounter_datetime between inicio_3HP.data_inicio_3HP and (inicio_3HP.data_inicio_3HP + INTERVAL 4 month) and e.location_id= :location     	"
            + "		group by inicio_3HP.patient_id, e.encounter_datetime having count(*)>=3                                                                        "
            + "	union                                                                                                                                                	"
            + "	select inicio_3HP.patient_id from                                                                                                                    	"
            + "	(                                                                                                                                                    	"
            + "		select p.patient_id, e.encounter_datetime data_inicio_3HP from patient p                                                                            "
            + "			inner join encounter e on p.patient_id=e.patient_id                                                                                        		"
            + "			inner join obs o on o.encounter_id=e.encounter_id                                                                                        		"
            + "		where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9) and o.concept_id=1719 and o.value_coded=23954                     		"
            + "			and e.encounter_datetime < :endDate and e.location_id= :location                                                                        		"
            + "		union                                                                                                                                            	"
            + "		select p.patient_id, e.encounter_datetime data_inicio_3HP from patient p                                                                            "
            + "			inner join encounter e on p.patient_id=e.patient_id                                                                                        		"
            + "			inner join obs o on o.encounter_id=e.encounter_id                                                                                        		"
            + "		where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=60  and o.concept_id=23985 and o.value_coded in (23954,23984)              		"
            + "			and  e.encounter_datetime < :endDate and e.location_id= :location                                                                        		"
            + "	) inicio_3HP                                                                                                                                        	"
            + "		inner join encounter e on e.patient_id= inicio_3HP.patient_id                                                                                       "
            + "		inner join obs obs3hp on obs3hp.encounter_id=e.encounter_id                                                                                         "
            + "		inner join obs obsTipo on obsTipo.encounter_id=e.encounter_id                                                                                       "
            + "	where e.voided=0 and obs3hp.voided=0 and obsTipo.voided=0                                                                                             	"
            + "		and e.encounter_type=60 and obs3hp.concept_id=23985 and obs3hp.value_coded in (23954,23984) and obsTipo.concept_id=23986 and obsTipo.value_coded=23720  "
            + "		and e.encounter_datetime between inicio_3HP.data_inicio_3HP and (inicio_3HP.data_inicio_3HP + INTERVAL 4 month) and e.location_id= :location     	"
            + "		group by inicio_3HP.patient_id, e.encounter_datetime having count(*)>=1                                                                        "
            + "	union                                                                                                                                                	"
            + "	select inicio_3HP.patient_id from                                                                                                                    	"
            + "	(                                                                                                                                                    	"
            + "		select p.patient_id, e.encounter_datetime data_inicio_3HP from patient p                                                                            "
            + "			inner join encounter e on p.patient_id=e.patient_id                                                                                        		"
            + "			inner join obs o on o.encounter_id=e.encounter_id                                                                                        		"
            + "		where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9) and o.concept_id=1719 and o.value_coded=23954                     		"
            + "			and e.encounter_datetime < :endDate and e.location_id= :location                                                                        		"
            + "		union                                                                                                                                            	"
            + "		select p.patient_id, e.encounter_datetime data_inicio_3HP from patient p                                                                            "
            + "			inner join encounter e on p.patient_id=e.patient_id                                                                                        		"
            + "			inner join obs o on o.encounter_id=e.encounter_id                                                                                        		"
            + "		where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=60  and o.concept_id=23985 and o.value_coded in (23954,23984)              		"
            + "			and  e.encounter_datetime < :endDate and e.location_id= :location                                                                        		"
            + "	) inicio_3HP                                                                                                                                        	"
            + "		inner join encounter e on e.patient_id= inicio_3HP.patient_id                                                                                       "
            + "		inner join obs obs3hp on obs3hp.encounter_id=e.encounter_id                                                                                         "
            + "		inner join obs obsTipo on obsTipo.encounter_id=e.encounter_id                                                                                       "
            + "	where e.voided=0 and obs3hp.voided=0 and obsTipo.voided=0                                                                                             	"
            + "		and e.encounter_type=60 and obs3hp.concept_id=23985 and obs3hp.value_coded in (23954,23984) and obsTipo.concept_id=23986 and obsTipo.value_coded=1098 "
            + "		and e.encounter_datetime between inicio_3HP.data_inicio_3HP and (inicio_3HP.data_inicio_3HP + INTERVAL 4 month) and e.location_id= :location    	"
            + "		group by inicio_3HP.patient_id, e.encounter_datetime having count(*)>=3                                                                        ";

    public static final String
        findPatientsWhoStartedTbPrevPreventiveTreatmentDuringPreviousReportingPeriod =
            "																"
                + "                select patient_id from 														                                        						"
                + "                (																					        												"
                + "                	select inicio_3HP.patient_id,	min(inicio_3HP.data_inicio_tpi) data_inicio_tpi from (										        		"
                + "                		select inicio.patient_id,inicio.data_inicio_tpi from 																					"
                + "                		(	select p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p														"
                + "                				inner join encounter e on p.patient_id=e.patient_id																				"
                + "                				inner join obs o on o.encounter_id=e.encounter_id																				"
                + "                			where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate 	                    "
                + "                				and o.voided=0 and o.concept_id=1719 and o.value_coded=23954 and e.encounter_type in (6,9) and  e.location_id=:location			"
                + "                			group by p.patient_id																												"
                + "                		) inicio 																																"
                + "                		left join 																																"
                + "                		(	select p.patient_id,e.encounter_datetime data_inicio_tpi from patient p																"
                + "                				inner join encounter e on p.patient_id=e.patient_id																				"
                + "                				inner join obs o on o.encounter_id=e.encounter_id																				"
                + "                			where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 17 month) and :endDate                         "
                + "                				and o.voided=0 and o.concept_id=1719 and o.value_coded=23954 and e.encounter_type in (6,9) and  e.location_id=:location			"
                + "                		) inicioAnterior on inicio.patient_id=inicioAnterior.patient_id  																		"
                + "                			and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 4 MONTH) and (inicio.data_inicio_tpi - INTERVAL 1 day)"
                + "                		where inicioAnterior.patient_id is null																									"
                + "                		union																																	"
                + "                		select inicio.patient_id,inicio.data_inicio_tpi from																					"
                + "                		(	select p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p														"
                + "                				inner join encounter e on p.patient_id=e.patient_id																				"
                + "                				inner join obs o on o.encounter_id=e.encounter_id																				"
                + "                			where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate                       	"
                + "                				and o.voided=0 and o.concept_id=23985 and o.value_coded in (23954,23984) and e.encounter_type=60 and  e.location_id=:location	"
                + "                			group by p.patient_id																												"
                + "                		) inicio 																																"
                + "                		left join 																																"
                + "                		(	select p.patient_id,e.encounter_datetime data_inicio_tpi from patient p																"
                + "                				inner join encounter e on p.patient_id=e.patient_id																				"
                + "                				inner join obs o on o.encounter_id=e.encounter_id																				"
                + "                			where  e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 17 month) and :endDate                        "
                + "                				 and o.voided=0 and o.concept_id=23985 and o.value_coded in (23954,23984) and e.encounter_type=60 and  e.location_id=:location	"
                + "                		) inicioAnterior on inicioAnterior.patient_id=inicio.patient_id  																		"
                + "                			and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 4 MONTH) and (inicio.data_inicio_tpi - INTERVAL 1 day)"
                + "                		where inicioAnterior.patient_id is null																									"
                + "                	) inicio_3HP group by inicio_3HP.patient_id																									"
                + "                	union																																		"
                + "                	select inicio_INH.patient_id,	min(inicio_INH.data_inicio_tpi) data_inicio_tpi from (														"
                + "                		select inicio.patient_id,inicio.data_inicio_tpi from																					"
                + "                		(	select p.patient_id,min(e.encounter_datetime) data_inicio_tpi	from	patient p													"
                + "                				inner join encounter e on p.patient_id=e.patient_id																				"
                + "                				inner join obs o on o.encounter_id=e.encounter_id																				"
                + "                			where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate                       	"
                + "                				and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location		"
                + "                			group by p.patient_id																												"
                + "                		)inicio																																	"
                + "                		left join 																																"
                + "                		(	select p.patient_id,e.encounter_datetime data_inicio_tpi from patient p																"
                + "                				inner join encounter e on p.patient_id=e.patient_id																				"
                + "                				inner join obs o on o.encounter_id=e.encounter_id																				"
                + "                			where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 20 month) and :endDate                         "
                + "                				and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location		"
                + "                		) inicioAnterior on inicioAnterior.patient_id=inicio.patient_id  																		"
                + "                			and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 7 MONTH) and (inicio.data_inicio_tpi - INTERVAL 1 day)"
                + "                		where inicioAnterior.patient_id is null																									"
                + "                		union																																	"
                + "                		select p.patient_id,min(o.value_datetime) data_inicio_tpi from patient p																"
                + "                				inner join encounter e on p.patient_id=e.patient_id																				"
                + "                				inner join obs o on o.encounter_id=e.encounter_id																				"
                + "                			where e.voided=0 and p.voided=0 and o.value_datetime between (:endDate - interval 7 month) and :endDate                        	    "
                + "                				and o.voided=0 and o.concept_id=6128 and e.encounter_type in (6,9,53) and e.location_id=:location								"
                + "                			group by p.patient_id																												"
                + "                		union 																																	"
                + "                		select p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p															"
                + "                				inner join encounter e on p.patient_id=e.patient_id																				"
                + "                				inner join obs o on o.encounter_id=e.encounter_id																				"
                + "                			where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate                         "
                + "                				and o.voided=0 and o.concept_id=6122 and o.value_coded=1256 and e.encounter_type in (6,9) and  e.location_id=:location			"
                + "                			group by p.patient_id																												"
                + "                	) inicio_INH group by inicio_INH.patient_id																									"
                + "               ) inicio_TPT												 																					";

    public static final String
        findPatientsWhoStartedArtAndTbPrevPreventiveTreatmentInDisaggregation(
            DisaggregationTypes disaggregationType) {

      String query =
          "                                                                                          																"
              + "select inicio_TPT.patient_id from 																													"
              + "(																																					"
              + "	select inicio_3HP.patient_id,	min(inicio_3HP.data_inicio_tpi) data_inicio_tpi from (															"
              + "		select inicio.patient_id,inicio.data_inicio_tpi from 																						"
              + "		(	select p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p															"
              + "				inner join encounter e on p.patient_id=e.patient_id																					"
              + "				inner join obs o on o.encounter_id=e.encounter_id																					"
              + "			where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate 					 		"
              + "				and o.voided=0 and o.concept_id=1719 and o.value_coded=23954 and e.encounter_type in (6,9) and  e.location_id=:location				"
              + "			group by p.patient_id																													"
              + "		) inicio 																																	"
              + "		left join 																																	"
              + "		(	select p.patient_id,e.encounter_datetime data_inicio_tpi from patient p																	"
              + "				inner join encounter e on p.patient_id=e.patient_id																					"
              + "				inner join obs o on o.encounter_id=e.encounter_id																					"
              + "			where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 17 month) and :endDate 						 	"
              + "				and o.voided=0 and o.concept_id=1719 and o.value_coded=23954 and e.encounter_type in (6,9) and  e.location_id=:location				"
              + "		) inicioAnterior on inicio.patient_id=inicioAnterior.patient_id  																			"
              + "			and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 4 MONTH) and (inicio.data_inicio_tpi - INTERVAL 1 day)	"
              + "		where inicioAnterior.patient_id is null																										"
              + "		union																																		"
              + "		select inicio.patient_id,inicio.data_inicio_tpi from																						"
              + "		(	select p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p															"
              + "				inner join encounter e on p.patient_id=e.patient_id																					"
              + "				inner join obs o on o.encounter_id=e.encounter_id																					"
              + "			where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate 							"
              + "				and o.voided=0 and o.concept_id=23985 and o.value_coded in (23954,23984) and e.encounter_type=60 and  e.location_id=:location		"
              + "			group by p.patient_id																													"
              + "		) inicio 																																	"
              + "		left join 																																	"
              + "		(	select p.patient_id,e.encounter_datetime data_inicio_tpi from patient p																	"
              + "				inner join encounter e on p.patient_id=e.patient_id																					"
              + "				inner join obs o on o.encounter_id=e.encounter_id																					"
              + "			where  e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 17 month) and :endDate 							"
              + "				 and o.voided=0 and o.concept_id=23985 and o.value_coded in (23954,23984) and e.encounter_type=60 and  e.location_id=:location		"
              + "		) inicioAnterior on inicioAnterior.patient_id=inicio.patient_id  																			"
              + "			and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 4 MONTH) and (inicio.data_inicio_tpi - INTERVAL 1 day)	"
              + "		where inicioAnterior.patient_id is null																										"
              + "	) inicio_3HP group by inicio_3HP.patient_id																										"
              + "	union																																			"
              + "	select inicio_INH.patient_id,	min(inicio_INH.data_inicio_tpi) data_inicio_tpi from (															"
              + "		select inicio.patient_id,inicio.data_inicio_tpi from																						"
              + "		(	select p.patient_id,min(e.encounter_datetime) data_inicio_tpi	from	patient p														"
              + "				inner join encounter e on p.patient_id=e.patient_id																					"
              + "				inner join obs o on o.encounter_id=e.encounter_id																					"
              + "			where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate 							"
              + "				and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location			"
              + "			group by p.patient_id																													"
              + "		)inicio																																		"
              + "		left join 																																	"
              + "		(	select p.patient_id,e.encounter_datetime data_inicio_tpi from patient p																	"
              + "				inner join encounter e on p.patient_id=e.patient_id																					"
              + "				inner join obs o on o.encounter_id=e.encounter_id																					"
              + "			where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 20 month) and :endDate 						 	"
              + "				and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location			"
              + "		) inicioAnterior on inicioAnterior.patient_id=inicio.patient_id  																			"
              + "			and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 7 MONTH) and (inicio.data_inicio_tpi - INTERVAL 1 day)	"
              + "		where inicioAnterior.patient_id is null																										"
              + "		union																																		"
              + "		select inicio.patient_id,inicio.data_inicio_tpi from																						"
              + "		(	select p.patient_id,min(o.value_datetime) data_inicio_tpi from patient p																"
              + "				inner join encounter e on p.patient_id=e.patient_id																					"
              + "				inner join obs o on o.encounter_id=e.encounter_id																					"
              + "			where e.voided=0 and p.voided=0 and o.value_datetime between (:endDate - interval 7 month) and :endDate 					 			"
              + "				and o.voided=0 and o.concept_id=6128 and e.encounter_type in (6,9,53) and e.location_id=:location									"
              + "			group by p.patient_id																													"
              + "		) inicio																																	"
              + "		union 																																		"
              + "		select inicio.patient_id,inicio.data_inicio_tpi from																						"
              + "		(	select p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p															"
              + "				inner join encounter e on p.patient_id=e.patient_id																					"
              + "				inner join obs o on o.encounter_id=e.encounter_id																					"
              + "			where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate 					 		"
              + "				and o.voided=0 and o.concept_id=6122 and o.value_coded=1256 and e.encounter_type in (6,9) and  e.location_id=:location 				"
              + "			group by p.patient_id																													"
              + "		) inicio 																																	"
              + "	) inicio_INH group by inicio_INH.patient_id																										"
              + ") inicio_TPT												 																						"
              + "inner join ( 																																	"
              + "	Select inicio_real.patient_id,min(data_inicio) data_inicio from( 																				"
              + "		select p.patient_id,min(e.encounter_datetime) data_inicio from  patient p 																	"
              + "			inner join encounter e on p.patient_id=e.patient_id 																					"
              + "			inner join obs o on o.encounter_id=e.encounter_id 																						"
              + "		where e.voided=0 and o.voided=0 and p.voided=0 and  e.encounter_type in (18,6,9) and o.concept_id=1255 and o.value_coded=1256 				"
              + "			and e.encounter_datetime<=:endDate and e.location_id=:location group by p.patient_id 													"
              + "		union 																																		"
              + "		select p.patient_id,min(value_datetime) data_inicio from  patient p 																		"
              + "			inner join encounter e on p.patient_id=e.patient_id 																					"
              + "			inner join obs o on e.encounter_id=o.encounter_id 																						"
              + "		where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (18,6,9,53) and  o.concept_id=1190 									"
              + "			and o.value_datetime is not null and  o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id 						"
              + "		union 																																		"
              + "		select pg.patient_id,min(date_enrolled) data_inicio from patient p 																			"
              + "			inner join patient_program pg on p.patient_id=pg.patient_id 																			"
              + "		where pg.voided=0 and p.voided=0 and program_id=2 and date_enrolled<=:endDate and location_id=:location group by pg.patient_id 				"
              + "		union 																																		"
              + "		SELECT e.patient_id, MIN(e.encounter_datetime) AS data_inicio FROM patient p 																"
              + "			inner join encounter e on p.patient_id=e.patient_id WHERE 																				"
              + "				p.voided=0 and e.encounter_type=18 AND e.voided=0 and e.encounter_datetime<=:endDate and e.location_id=:location GROUP BY  p.patient_id "
              + "		union 																																		"
              + "		select p.patient_id,min(value_datetime) data_inicio from patient p 																			"
              + "			inner join encounter e on p.patient_id=e.patient_id 																					"
              + "			inner join obs o on e.encounter_id=o.encounter_id 																						"
              + "		where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=52 																		"
              + "			and o.concept_id=23866 and o.value_datetime is not null and  o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id "
              + "	) inicio_real group by patient_id 																												"
              + " ) inicioTarv on inicioTarv.patient_id = inicio_TPT.patient_id 																					";

      switch (disaggregationType) {
        case NEWLY_ENROLLED:
          query =
              query
                  + "and inicio_TPT.data_inicio_tpi <= DATE_ADD(inicioTarv.data_inicio, INTERVAL 6 MONTH)";
          break;

        case PREVIOUSLY_ENROLLED:
          query =
              query
                  + " and inicio_TPT.data_inicio_tpi > DATE_ADD(inicioTarv.data_inicio, INTERVAL 6 MONTH)";
          break;
      }
      return query;
    }

    public static final String
        findPatientsWhoCompletedTbPrevPreventiveTreatmentDuringReportingPeriod =
            " select inicio_tpt.patient_id from (               "
                + "                        select inicio3hp.patient_id from                               "
                + "                        (       select inicio.patient_id,inicio.data_inicio_tpi from     "
                + "                                (       select p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                                                inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                        where   e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                   and  o.voided=0 and o.concept_id=1719 and o.value_coded=23954   "
                + "                                                   and e.encounter_type in (6,9) and  e.location_id=:location group by p.patient_id                "
                + "                                ) inicio                                       "
                + "                                left join                                               "
                + "                                (       select p.patient_id,e.encounter_datetime data_inicio_tpi from patient p  "
                + "                                                inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                        where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 17 month) and :endDate   "
                + "                                                and o.voided=0 and o.concept_id=1719 and o.value_coded=23954 and e.encounter_type in (6,9) and  e.location_id=:location    "
                + "                                ) inicioAnterior on inicio.patient_id=inicioAnterior.patient_id   "
                + "                                        and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 4 MONTH)   "
                + "                                        and (inicio.data_inicio_tpi - INTERVAL 1 day)  "
                + "                                where inicioAnterior.patient_id is null                       "
                + "                        ) inicio3hp                                            "
                + "                                inner join encounter e on e.patient_id=inicio3hp.patient_id    "
                + "                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                        where   e.voided=0 and o.voided=0 and o.concept_id=1719 and o.value_coded=23954 and e.encounter_type in (6,9) and e.location_id=:location  "
                + "                                and e.encounter_datetime between inicio3hp.data_inicio_tpi and (inicio3hp.data_inicio_tpi + INTERVAL 4 month)     "
                + "                                group by inicio3hp.patient_id having count(*)>=3       "
                + "                        union                                                  "
                + "                        select inicio3hp.patient_id from                  "
                + "                        (       select inicio.patient_id,inicio.data_inicio_tpi from          "
                + "                                (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                                                inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                        where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                and  o.voided=0 and o.concept_id=23985 and o.value_coded in (23954,23984) and e.encounter_type=60 and  e.location_id=:location  "
                + "                                                group by p.patient_id  "
                + "                                  ) inicio                                             "
                + "                                  left join                                                    "
                + "                                  (     select  p.patient_id,e.encounter_datetime data_inicio_tpi from patient p  "
                + "                                                inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                        where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 17 month) and :endDate   "
                + "                                                and o.voided=0 and o.concept_id=23985 and o.value_coded in (23954,23984) and e.encounter_type=60 and  e.location_id=:location     "
                + "                                   ) inicioAnterior on inicioAnterior.patient_id=inicio.patient_id                                                                                                "
                + "                                        and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 4 MONTH) and (inicio.data_inicio_tpi - INTERVAL 1 day)  "
                + "                                   where inicioAnterior.patient_id is null                        "
                + "                        ) inicio3hp                                                            "
                + "                              inner join encounter e on e.patient_id=inicio3hp.patient_id    "
                + "                              inner join obs obs3hp on obs3hp.encounter_id=e.encounter_id    "
                + "                              inner join obs obsTipo on obsTipo.encounter_id=e.encounter_id  "
                + "                        where e.voided=0 and obs3hp.voided=0 and obsTipo.voided=0 and e.encounter_type=60 and e.location_id=:location   "
                + "                           and e.encounter_datetime between inicio3hp.data_inicio_tpi and (inicio3hp.data_inicio_tpi + INTERVAL 4 month)   "
                + "                           and obs3hp.concept_id=23985 and obs3hp.value_coded in (23954,23984)       "
                + "                           and obsTipo.concept_id=23986 and obsTipo.value_coded=1098        "
                + "                           group by inicio3hp.patient_id having count(*)>=3       "
                + "                        union                                                           "
                + "                        select inicio3hp.patient_id from                               "
                + "                        (       select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "                                (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                                                inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                        where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                and o.voided=0 and o.concept_id=23985 and o.value_coded in (23954,23984) and e.encounter_type=60 and  e.location_id=:location     "
                + "                                        group by p.patient_id                      "
                + "                                ) inicio                                         "
                + "                                left join                                              "
                + "                                (       select  p.patient_id,e.encounter_datetime data_inicio_tpi from patient p  "
                + "                                                inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                        where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 17 month) and :endDate   "
                + "                                                and o.voided=0 and o.concept_id=23985 and o.value_coded in (23954,23984) and e.encounter_type=60 and  e.location_id=:location    "
                + "                                ) inicioAnterior on inicioAnterior.patient_id=inicio.patient_id   "
                + "                                        and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 4 MONTH) and (inicio.data_inicio_tpi - INTERVAL 1 day)     "
                + "                                where inicioAnterior.patient_id is null                "
                + "                         ) inicio3hp                                                   "
                + "                                inner join encounter e on e.patient_id=inicio3hp.patient_id    "
                + "                           inner join obs obs3hp on obs3hp.encounter_id=e.encounter_id    "
                + "                           inner join obs obsTipo on obsTipo.encounter_id=e.encounter_id  "
                + "                        where e.voided=0 and obs3hp.voided=0 and obsTipo.voided=0               "
                + "                                and e.encounter_type=60 and e.location_id=:location and e.encounter_datetime between inicio3hp.data_inicio_tpi and :endDate   "
                + "                                and obs3hp.concept_id=23985 and obs3hp.value_coded in (23954,23984)        "
                + "                                and     obsTipo.concept_id=23986 and obsTipo.value_coded=23720       "
                + "                        group by inicio3hp.patient_id                                "
                + "                        union                                                  "
                + "                        select inicio_tpi.patient_id from                              "
                + "                        (       select iniciotpi.patient_id,min(iniciotpi.data_inicio_tpi) data_inicio_tpi from     "
                + "                                (       select inicio.patient_id,inicio.data_inicio_tpi from     "
                + "                                        (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                                                        inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                                where   e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                        and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location            "
                + "                                                        group by p.patient_id   "
                + "                                        )inicio                                 "
                + "                                        left join                                        "
                + "                                        (       select p.patient_id,e.encounter_datetime data_inicio_tpi from patient p             "
                + "                                                  inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                  inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                                where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 20 month) and :endDate  "
                + "                                                        and  o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location      "
                + "                                        ) inicioAnterior on inicioAnterior.patient_id=inicio.patient_id                                                                                       "
                + "                                                and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 7 MONTH) and (inicio.data_inicio_tpi - INTERVAL 1 day)   "
                + "                                        where inicioAnterior.patient_id is null                 "
                + "                                        union                                                   "
                + "                                        select inicio.patient_id,inicio.data_inicio_tpi from    "
                + "                                        (       select  p.patient_id,min(o.value_datetime) data_inicio_tpi from patient p             "
                + "                                                inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                  inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                                where e.voided=0 and p.voided=0 and o.value_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                        and o.voided=0 and o.concept_id=6128 and e.encounter_type in (6,9,53) and e.location_id=:location      "
                + "                                                        group by p.patient_id                            "
                + "                                        ) inicio                                                    "
                + "                                        union                                                           "
                + "                                        select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "                                        (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                                                        inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                                where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                        and  o.voided=0 and o.concept_id=6122 and o.value_coded=1256 and e.encounter_type in (6,9) and  e.location_id=:location               "
                + "                                                        group by p.patient_id             "
                + "                                        ) inicio                                         "
                + "                                ) iniciotpi group by iniciotpi.patient_id                                  "
                + "                        ) inicio_tpi                                           "
                + "                        inner join                                               "
                + "                        (       select patient_id, max(data_final_tpi) data_final_tpi   from  "
                + "                                (       select  p.patient_id,max(o.value_datetime) data_final_tpi from patient p             "
                + "                                        inner join encounter e on p.patient_id=e.patient_id   "
                + "                                          inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                        where   e.voided=0 and p.voided=0 and o.value_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                        and  o.voided=0 and o.concept_id=6129 and e.encounter_type in (6,9,53) and e.location_id=:location    "
                + "                                   group by p.patient_id                                       "
                + "                                   union                                                       "
                + "                                   select p.patient_id,max(e.encounter_datetime) data_final_tpi from patient p             "
                + "                                          inner join encounter e on p.patient_id=e.patient_id   "
                + "                                          inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                   where   e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                          and o.voided=0 and o.concept_id=6122 and o.value_coded=1267 and e.encounter_type=6   "
                + "                                         and e.location_id=:location group by p.patient_id         "
                + "                                ) endTPI group by patient_id  "
                + "                        ) termino_tpi on inicio_tpi.patient_id=termino_tpi.patient_id  "
                + "                        where termino_tpi.data_final_tpi>=inicio_tpi.data_inicio_tpi + interval 173 day       "
                + "                        union                                                                  "
                + "select d1.patient_id from "
                + "( "
                + "select inicio_tpi.patient_id from                                       "
                + "(       select iniciotpi.patient_id,min(iniciotpi.data_inicio_tpi) data_inicio_tpi from     "
                + "       (       select inicio.patient_id,inicio.data_inicio_tpi from     "
                + "               (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                               inner join encounter e on p.patient_id=e.patient_id   "
                + "                       inner join obs o on o.encounter_id=e.encounter_id     "
                + "                       where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                               and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location           "
                + "                               group by p.patient_id          "
                + "               ) inicio                                        "
                + "               left join                                          "
                + "               (       select p.patient_id,e.encounter_datetime data_inicio_tpi from patient p             "
                + "                       inner join encounter e on p.patient_id=e.patient_id   "
                + "                       inner join obs o on o.encounter_id=e.encounter_id     "
                + "                       where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 20 month) and :endDate   "
                + "                               and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location   "
                + "               ) inicioAnterior on inicioAnterior.patient_id=inicio.patient_id    "
                + "                       and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 7 MONTH) and (inicio.data_inicio_tpi - INTERVAL 1 day)  "
                + "               where inicioAnterior.patient_id is null                                 "
                + "               union                                                  "
                + "               select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "               (       select  p.patient_id,min(o.value_datetime) data_inicio_tpi from patient p             "
                + "                       inner join encounter e on p.patient_id=e.patient_id   "
                + "                       inner join obs o on o.encounter_id=e.encounter_id     "
                + "                       where e.voided=0 and p.voided=0 and o.value_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                               and o.voided=0 and o.concept_id=6128 and e.encounter_type in (6,9,53) and e.location_id=:location  "
                + "                               group by p.patient_id                  "
                + "               ) inicio union                                         "
                + "               select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "               (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                               inner join encounter e on p.patient_id=e.patient_id   "
                + "                       inner join obs o on o.encounter_id=e.encounter_id     "
                + "                       where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                               and o.voided=0 and o.concept_id=6122 and o.value_coded=1256 and e.encounter_type in (6,9) and  e.location_id=:location   "
                + "                       group by p.patient_id                          "
                + "               ) inicio                                                 "
                + "       ) iniciotpi group by iniciotpi.patient_id                              "
                + ") inicio_tpi                                                           "
                + "       inner join encounter e on e.patient_id=inicio_tpi.patient_id   "
                + "       inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id             "
                + "where e.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (6,9)   "
                + "       and e.encounter_datetime between inicio_tpi.data_inicio_tpi and (inicio_tpi.data_inicio_tpi + INTERVAL 7 MONTH)   "
                + "       and obsLevTPI.concept_id=6122 and obsLevTPI.value_coded in (1257,1065,1256) and e.location_id=:location   "
                + "       group by inicio_tpi.patient_id having count(*)>=6   "
                + ")d1 "
                + "left join "
                + "( "
                + "select inicio_tpi.patient_id from                                       "
                + "(       select iniciotpi.patient_id,min(iniciotpi.data_inicio_tpi) data_inicio_tpi from     "
                + "       (       select inicio.patient_id,inicio.data_inicio_tpi from     "
                + "               (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                               inner join encounter e on p.patient_id=e.patient_id   "
                + "                       inner join obs o on o.encounter_id=e.encounter_id     "
                + "                       where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                               and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location           "
                + "                               group by p.patient_id          "
                + "               ) inicio                                        "
                + "               left join                                          "
                + "               (       select p.patient_id,e.encounter_datetime data_inicio_tpi from patient p             "
                + "                       inner join encounter e on p.patient_id=e.patient_id   "
                + "                       inner join obs o on o.encounter_id=e.encounter_id     "
                + "                       where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 20 month) and :endDate   "
                + "                               and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location   "
                + "               ) inicioAnterior on inicioAnterior.patient_id=inicio.patient_id    "
                + "                       and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 7 MONTH) and (inicio.data_inicio_tpi - INTERVAL 1 day)  "
                + "               where inicioAnterior.patient_id is null                                 "
                + "               union                                                  "
                + "               select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "               (       select  p.patient_id,min(o.value_datetime) data_inicio_tpi from patient p             "
                + "                       inner join encounter e on p.patient_id=e.patient_id   "
                + "                       inner join obs o on o.encounter_id=e.encounter_id     "
                + "                       where e.voided=0 and p.voided=0 and o.value_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                               and o.voided=0 and o.concept_id=6128 and e.encounter_type in (6,9,53) and e.location_id=:location  "
                + "                               group by p.patient_id                  "
                + "               ) inicio union                                         "
                + "               select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "               (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                               inner join encounter e on p.patient_id=e.patient_id   "
                + "                       inner join obs o on o.encounter_id=e.encounter_id     "
                + "                       where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                               and o.voided=0 and o.concept_id=6122 and o.value_coded=1256 and e.encounter_type in (6,9) and  e.location_id=:location   "
                + "                       group by p.patient_id                          "
                + "               ) inicio                                                 "
                + "       ) iniciotpi group by iniciotpi.patient_id                              "
                + ") inicio_tpi                                                           "
                + "       inner join encounter e on e.patient_id=inicio_tpi.patient_id   "
                + "       inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id            "
                + "       inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id   "
                + "where e.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (6,9)   "
                + "       and e.encounter_datetime between inicio_tpi.data_inicio_tpi and (inicio_tpi.data_inicio_tpi + INTERVAL 7 MONTH)   "
                + "       and obsLevTPI.concept_id=6122 and obsLevTPI.value_coded in (1257,1065,1256) "
                + "       and obsDTINH.voided=0 and obsDTINH.concept_id=1719 and obsDTINH.value_coded=23955 and e.location_id=:location   "
                + "       group by inicio_tpi.patient_id having count(*)>=6   "
                + ") d2 on d1.patient_id = d2.patient_id "
                + "where d2.patient_id is null              "
                + "                        union                                                   "
                + "                        select inicio_tpi.patient_id from                              "
                + "                        (       select iniciotpi.patient_id,min(iniciotpi.data_inicio_tpi) data_inicio_tpi from     "
                + "                                (       select inicio.patient_id,inicio.data_inicio_tpi from     "
                + "                                        (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                                                        inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                                where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate    "
                + "                                                        and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location     "
                + "                                                        group by p.patient_id             "
                + "                                        )inicio                                        "
                + "                                        left join                                              "
                + "                                        (       select  p.patient_id,e.encounter_datetime data_inicio_tpi from patient p             "
                + "                                                inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                                where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 20 month) and :endDate   "
                + "                                                        and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location             "
                + "                                   ) inicioAnterior on inicioAnterior.patient_id=inicio.patient_id   "
                + "                                                and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 7 MONTH) and (inicio.data_inicio_tpi - INTERVAL 1 day)   "
                + "                                   where inicioAnterior.patient_id is null      "
                + "                                   union                                       "
                + "                                   select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "                                   (    select p.patient_id,min(o.value_datetime) data_inicio_tpi from patient p             "
                + "                                        inner join encounter e on p.patient_id=e.patient_id   "
                + "                                          inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                        where e.voided=0 and p.voided=0 and o.value_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                and o.voided=0 and o.concept_id=6128 and e.encounter_type in (6,9,53) and e.location_id=:location  "
                + "                                                group by p.patient_id             "
                + "                                   ) inicio                                                "
                + "                                   union                                       "
                + "                                   select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "                                   (    select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                                                inner join encounter e on p.patient_id=e.patient_id   "
                + "                                          inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                        where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                and o.voided=0 and o.concept_id=6122 and o.value_coded=1256 and e.encounter_type in (6,9) and  e.location_id=:location   "
                + "                                                group by p.patient_id             "
                + "                                   ) inicio                                            "
                + "                                ) iniciotpi group by iniciotpi.patient_id               "
                + "                        ) inicio_tpi                                           "
                + "                                inner join encounter e on e.patient_id=inicio_tpi.patient_id   "
                + "                          inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id            "
                + "                        where e.voided=0 and obsLevTPI.voided=0 and e.encounter_type=60         "
                + "                                and e.encounter_datetime between inicio_tpi.data_inicio_tpi and (inicio_tpi.data_inicio_tpi + INTERVAL 7 MONTH)  "
                + "                                and obsLevTPI.concept_id=23985 and obsLevTPI.value_coded in (656,23982) and e.location_id=:location        "
                + "                                group by inicio_tpi.patient_id having count(*)>=6       "
                + "                        union                                                    "
                + "                        select inicio_tpi.patient_id from                              "
                + "                        (       select iniciotpi.patient_id,min(iniciotpi.data_inicio_tpi) data_inicio_tpi from   "
                + "                                (       select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "                                        (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                                                        inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                                where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                        and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location            "
                + "                                                        group by p.patient_id             "
                + "                                        ) inicio                                       "
                + "                                        left join                                              "
                + "                                        (       select  p.patient_id,e.encounter_datetime data_inicio_tpi from patient p             "
                + "                                                inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                        inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                                where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 20 month) and :endDate  "
                + "                                                        and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location         "
                + "                                        ) inicioAnterior on inicioAnterior.patient_id=inicio.patient_id   "
                + "                                                and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 7 MONTH) and (inicio.data_inicio_tpi - INTERVAL 1 day)   "
                + "                                        where inicioAnterior.patient_id is null            "
                + "                                        union                                           "
                + "                                        select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "                                        (       select  p.patient_id,min(o.value_datetime) data_inicio_tpi from patient p             "
                + "                                                        inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                                where e.voided=0 and p.voided=0 and o.value_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                        and  o.voided=0 and o.concept_id=6128 and e.encounter_type in (6,9,53) and e.location_id=:location    "
                + "                                                        group by p.patient_id             "
                + "                                        ) inicio                                               "
                + "                                        union                                                   "
                + "                                        select inicio.patient_id,inicio.data_inicio_tpi from        "
                + "                                        (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                                                        inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                                where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                        and  o.voided=0 and o.concept_id=6122 and o.value_coded=1256 and e.encounter_type in (6,9) and  e.location_id=:location                 "
                + "                                                        group by p.patient_id             "
                + "                                        ) inicio                                               "
                + "                                ) iniciotpi group by iniciotpi.patient_id                      "
                + "                        ) inicio_tpi                                                   "
                + "                                inner join encounter e on e.patient_id=inicio_tpi.patient_id   "
                + "                             inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id              "
                + "                                inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id            "
                + "                        where e.voided=0 and obsDTINH.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (6,9)   "
                + "                                and e.encounter_datetime between inicio_tpi.data_inicio_tpi and (inicio_tpi.data_inicio_tpi + INTERVAL 5 MONTH)  "
                + "                                and obsDTINH.concept_id=1719 and obsDTINH.value_coded=23955 and e.location_id=:location and                    "
                + "                                   obsLevTPI.concept_id=6122 and obsLevTPI.value_coded in (1257,1065,1256)       "
                + "                                group by inicio_tpi.patient_id having count(*)>=2       "
                + "                        union                                                  "
                + "                        select inicio_tpi.patient_id from                              "
                + "                        (       select iniciotpi.patient_id, min(iniciotpi.data_inicio_tpi) data_inicio_tpi from     "
                + "                                (       select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "                                        (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                                                        inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                                where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                        and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location             "
                + "                                                        group by p.patient_id             "
                + "                                        )inicio                                "
                + "                                        left join                                  "
                + "                                        (       select  p.patient_id,e.encounter_datetime data_inicio_tpi from patient p  "
                + "                                                inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                                where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 20 month) and :endDate   "
                + "                                                        and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location             "
                + "                                        ) inicioAnterior on inicioAnterior.patient_id=inicio.patient_id  "
                + "                                                and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 7 MONTH) and (inicio.data_inicio_tpi - INTERVAL 1 day)   "
                + "                                        where inicioAnterior.patient_id is null         "
                + "                                        union                                              "
                + "                                        select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "                                        (       select  p.patient_id,min(o.value_datetime) data_inicio_tpi      from patient p  "
                + "                                                inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                                where e.voided=0 and p.voided=0 and o.value_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                        and  o.voided=0 and o.concept_id=6128 and e.encounter_type in (6,9,53) and e.location_id=:location   "
                + "                                                group by p.patient_id                           "
                + "                                        ) inicio                                         "
                + "                                        union                                                "
                + "                                        select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "                                        (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                                                inner join encounter e on p.patient_id=e.patient_id   "
                + "                                                inner join obs o on o.encounter_id=e.encounter_id     "
                + "                                                where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                        and  o.voided=0 and o.concept_id=6122 and o.value_coded=1256 and e.encounter_type in (6,9) and  e.location_id=:location   "
                + "                                                        group by p.patient_id          "
                + "                                        ) inicio                                               "
                + "                                ) iniciotpi group by iniciotpi.patient_id            "
                + "                        ) inicio_tpi                                                              "
                + "                              inner join encounter e on e.patient_id=inicio_tpi.patient_id                    "
                + "                              inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id                 "
                + "                              inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id               "
                + "                      where e.voided=0 and obsDTINH.voided=0 and obsLevTPI.voided=0 and e.encounter_type=60    "
                + "                                  and e.encounter_datetime between inicio_tpi.data_inicio_tpi and (inicio_tpi.data_inicio_tpi + INTERVAL 5 MONTH)    "
                + "                                  and obsDTINH.concept_id=23985 and obsDTINH.value_coded in (656,23982) and e.location_id=:location           "
                + "                                  and obsLevTPI.concept_id=23986 and obsLevTPI.value_coded=23720      "
                + "                                  group by inicio_tpi.patient_id having count(*)>=2  "
                + "                        union                                                    "
                + "                        select patient_id from                                         "
                + "                        (       select  inicio_tpi.patient_id, sum(if(obsLevTPI.concept_id=6122,1,0)) mensal, sum(if(obsLevTPI.concept_id=1719,1,0)) trimestral from  "
                + "                                (       select iniciotpi.patient_id, min(iniciotpi.data_inicio_tpi) data_inicio_tpi from     "
                + "                                        (       select inicio.patient_id,inicio.data_inicio_tpi from      "
                + "                                                (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                                                                inner join encounter e on p.patient_id=e.patient_id    "
                + "                                                                inner join obs o on o.encounter_id=e.encounter_id         "
                + "                                                        where   e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                        and  o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60   "
                + "                                                        and  e.location_id=:location  group by p.patient_id           "
                + "                                          ) inicio                                      "
                + "                                                left join                                      "
                + "                                                (       select  p.patient_id,e.encounter_datetime data_inicio_tpi from patient p  "
                + "                                                                inner join encounter e on p.patient_id=e.patient_id    "
                + "                                                                inner join obs o on o.encounter_id=e.encounter_id      "
                + "                                                        where   e.voided=0 and p.voided=0               "
                + "                                                        and e.encounter_datetime between (:endDate - interval 20 month) and :endDate   "
                + "                                                        and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60  and  e.location_id=:location                  "
                + "                                                ) inicioAnterior on inicioAnterior.patient_id=inicio.patient_id       "
                + "                                                        and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 7 MONTH)      "
                + "                                                        and (inicio.data_inicio_tpi - INTERVAL 1 day)   "
                + "                                                where inicioAnterior.patient_id is null  "
                + "                                                union                                           "
                + "                                                select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "                                                (       select  p.patient_id,min(o.value_datetime) data_inicio_tpi from patient p  "
                + "                                                                inner join encounter e on p.patient_id=e.patient_id    "
                + "                                                                inner join obs o on o.encounter_id=e.encounter_id      "
                + "                                                        where e.voided=0 and p.voided=0 and o.value_datetime between (:endDate - interval 7 month) and :endDate    "
                + "                                                                and o.voided=0 and o.concept_id=6128 and e.encounter_type in (6,9,53) and e.location_id=:location group by p.patient_id  "
                + "                                                ) inicio                                                      "
                + "                                                union                                                                  "
                + "                                                select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "                                                (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                                                                inner join encounter e on p.patient_id=e.patient_id    "
                + "                                                                inner join obs o on o.encounter_id=e.encounter_id      "
                + "                                                        where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate    "
                + "                                                                and o.voided=0 and o.concept_id=6122 and o.value_coded=1256 and e.encounter_type in (6,9) and  e.location_id=:location  "
                + "                                                                group by p.patient_id           "
                + "                                                ) inicio                                       "
                + "                                ) iniciotpi group by iniciotpi.patient_id                      "
                + "                        ) inicio_tpi                                                                    "
                + "                                inner join encounter e on e.patient_id=inicio_tpi.patient_id            "
                + "                                inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id       "
                + "                                left join obs obsOutrasPresc on (obsOutrasPresc.encounter_id  = e.encounter_id and obsOutrasPresc.concept_id = 1719 and obsOutrasPresc.value_coded in(23954,23955))   "
                + "                        where e.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (6,9)   "
                + "                                 and e.encounter_datetime between inicio_tpi.data_inicio_tpi and (inicio_tpi.data_inicio_tpi + INTERVAL 7 MONTH)   "
                + "                                 and ((obsLevTPI.concept_id = 6122 and  obsOutrasPresc.encounter_id is null) or (obsLevTPI.concept_id =1719 ))   "
                + "                                 and obsLevTPI.value_coded in (1257,1065,1256,23955) and e.location_id=:location group by inicio_tpi.patient_id  "
                + "                        ) inh                                                           "
                + "                        where mensal>=3 and trimestral>=1                                   "
                + "                        union                                                                  "
                + "                        select patient_id from                                                   "
                + "                        (       select  inicio_tpi.patient_id, sum(if(obsLevTPI.value_coded=1098,1,0)) mensal, sum(if(obsLevTPI.value_coded=23720,1,0)) trimestral from          "
                + "                                (       select iniciotpi.patient_id,min(iniciotpi.data_inicio_tpi) data_inicio_tpi from  "
                + "                                        (       select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "                                                (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                                                                inner join encounter e on p.patient_id=e.patient_id    "
                + "                                                                inner join obs o on o.encounter_id=e.encounter_id      "
                + "                                                        where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate    "
                + "                                                                and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location  "
                + "                                                                group by p.patient_id           "
                + "                                                ) inicio                                        "
                + "                                                left join                                              "
                + "                                                (       select  p.patient_id,e.encounter_datetime data_inicio_tpi from patient p  "
                + "                                                                inner join encounter e on p.patient_id=e.patient_id    "
                + "                                                                inner join obs o on o.encounter_id=e.encounter_id      "
                + "                                                        where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 20 month) and :endDate    "
                + "                                                                and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 and  e.location_id=:location            "
                + "                                                ) inicioAnterior on inicioAnterior.patient_id=inicio.patient_id    "
                + "                                                        and inicioAnterior.data_inicio_tpi between (inicio.data_inicio_tpi - INTERVAL 7 MONTH)         "
                + "                                                        and (inicio.data_inicio_tpi - INTERVAL 1 day)     "
                + "                                                where inicioAnterior.patient_id is null                     "
                + "                                                union                                           "
                + "                                                select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "                                                (       select  p.patient_id,min(o.value_datetime) data_inicio_tpi from patient p  "
                + "                                                                inner join encounter e on p.patient_id=e.patient_id    "
                + "                                                                inner join obs o on o.encounter_id=e.encounter_id      "
                + "                                                        where e.voided=0 and p.voided=0 and o.value_datetime between (:endDate - interval 7 month) and :endDate  "
                + "                                                                and o.voided=0 and o.concept_id=6128 and e.encounter_type in (6,9,53) and e.location_id=:location   "
                + "                                                        group by p.patient_id                       "
                + "                                                ) inicio                                        "
                + "                                                union                                           "
                + "                                                select inicio.patient_id,inicio.data_inicio_tpi from  "
                + "                                                (       select  p.patient_id,min(e.encounter_datetime) data_inicio_tpi from patient p  "
                + "                                                                inner join encounter e on p.patient_id=e.patient_id    "
                + "                                                                inner join obs o on o.encounter_id=e.encounter_id      "
                + "                                                        where e.voided=0 and p.voided=0 and e.encounter_datetime between (:endDate - interval 7 month) and :endDate   "
                + "                                                                and o.voided=0 and o.concept_id=6122 and o.value_coded=1256 and e.encounter_type in (6,9)   "
                + "                                                                and  e.location_id=:location group by p.patient_id           "
                + "                                                ) inicio                                       "
                + "                                        ) iniciotpi group by iniciotpi.patient_id           "
                + "                                ) inicio_tpi                                                   "
                + "                                        inner join encounter e on e.patient_id=inicio_tpi.patient_id            "
                + "                                        inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id         "
                + "                                        inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id       "
                + "                                where e.voided=0 and obsDTINH.voided=0 and obsLevTPI.voided=0 and e.encounter_type=60    "
                + "                                        and e.encounter_datetime between inicio_tpi.data_inicio_tpi and (inicio_tpi.data_inicio_tpi + INTERVAL 7 MONTH)    "
                + "                                        and obsDTINH.concept_id=23985 and obsDTINH.value_coded in (656,23982) and e.location_id=:location   "
                + "                                        and obsLevTPI.concept_id=23986 and obsLevTPI.value_coded in (23720,1098)  "
                + "                                    group by inicio_tpi.patient_id                     "
                + "                        ) inh                                                          "
                + "                        where mensal>=3 and trimestral>=1                     "
                + "                 ) inicio_tpt group by inicio_tpt.patient_id                            ";

    public static final String findPatientsWhoCompletedINHTherapy_query1 =
        "select inicio_inh.patient_id from                               "
            + " (     "
            + "       select p.patient_id, o.value_datetime data_inicio_inh              "
            + "             from  patient p     "
            + "    inner join encounter e on p.patient_id=e.patient_id             "
            + "    inner join obs o on o.encounter_id=e.encounter_id      "
            + "             where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128                "
            + "    and o.value_datetime < :endDate and e.location_id=:location     "
            + "       union          "
            + "       select p.patient_id, e.encounter_datetime data_inicio_inh    "
            + "             from patient p   "
            + "    inner join encounter e on p.patient_id=e.patient_id             "
            + "    inner join obs o on o.encounter_id=e.encounter_id      "
            + "             where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256    "
            + "    and e.encounter_datetime < :endDate and e.location_id=:location         "
            + "       union          "
            + "       select p.patient_id, e.encounter_datetime data_inicio_inh from patient p               "
            + "             inner join encounter e on p.patient_id=e.patient_id             "
            + "             inner join obs o on o.encounter_id=e.encounter_id      "
            + "       where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60   "
            + "             and e.encounter_datetime < :endDate and e.location_id=:location         "
            + " ) inicio_inh   "
            + " inner join     "
            + " (     select patient_id, data_final_inh        "
            + "       from(          "
            + "             select p.patient_id, o.value_datetime data_final_inh   "
            + "             from patient p   "
            + "    inner join encounter e on p.patient_id=e.patient_id             "
            + "    inner join obs o on o.encounter_id=e.encounter_id      "
            + "             where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6129         "
            + "    and o.value_datetime <= :endDate and e.location_id=:location    "
            + "             union            "
            + "             select p.patient_id, e.encounter_datetime data_final_inh              "
            + "             from patient p   "
            + "          inner join encounter e on p.patient_id=e.patient_id       "
            + "          inner join obs o on o.encounter_id=e.encounter_id               "
            + "             where       p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=6 and o.concept_id=6122 and o.value_coded=1267              "
            + "          and e.encounter_datetime<= :endDate and e.location_id=:location   "
            + "       ) endINH               "
            + " ) termino_inh on inicio_inh.patient_id=termino_inh.patient_id      "
            + " where termino_inh.data_final_inh between  inicio_inh.data_inicio_inh + interval 173 day and inicio_inh.data_inicio_inh + interval 365 day   ";

    public static final String findPatientsWhoCompletedINHTherapy_query2 =
        " select d1.patient_id 																"
            + "from "
            + "( "
            + "select distinct inicio_inh.patient_id from "
            + "  ( "
            + "        select p.patient_id, o.value_datetime data_inicio_inh "
            + "              from  patient p "
            + "     inner join encounter e on p.patient_id=e.patient_id "
            + "     inner join obs o on o.encounter_id=e.encounter_id "
            + "              where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128 "
            + "     and o.value_datetime < :endDate and e.location_id=:location "
            + "        union "
            + "        select p.patient_id, e.encounter_datetime data_inicio_inh "
            + "              from  patient p "
            + "     inner join encounter e on p.patient_id=e.patient_id "
            + "     inner join obs o on o.encounter_id=e.encounter_id "
            + "              where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256 "
            + "     and e.encounter_datetime < :endDate and e.location_id=:location "
            + "              union "
            + "              select p.patient_id, e.encounter_datetime data_inicio_inh from patient p "
            + "     inner join encounter e on p.patient_id=e.patient_id "
            + "     inner join obs o on o.encounter_id=e.encounter_id "
            + "              where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 "
            + "     and e.encounter_datetime < :endDate and e.location_id=:location "
            + "  ) inicio_inh "
            + "  inner join encounter e on e.patient_id=inicio_inh.patient_id "
            + "  inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id "
            + "  where e.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (6,9) and obsLevTPI.concept_id=6122 and obsLevTPI.value_coded in (1257,1065,1256) "
            + "        and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH) "
            + "        and e.location_id=:location "
            + "       group by inicio_inh.patient_id,inicio_inh.data_inicio_inh having count(*)>=6 "
            + ") d1 "
            + "left join      "
            + "( "
            + "   select distinct inicio_inh.patient_id from "
            + "  ( "
            + "        select p.patient_id, o.value_datetime data_inicio_inh "
            + "              from  patient p "
            + "     inner join encounter e on p.patient_id=e.patient_id "
            + "     inner join obs o on o.encounter_id=e.encounter_id "
            + "              where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128 "
            + "     and o.value_datetime < :endDate and e.location_id=:location "
            + "        union "
            + "        select p.patient_id, e.encounter_datetime data_inicio_inh "
            + "              from  patient p "
            + "     inner join encounter e on p.patient_id=e.patient_id "
            + "     inner join obs o on o.encounter_id=e.encounter_id "
            + "              where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256 "
            + "     and e.encounter_datetime < :endDate and e.location_id=:location "
            + "              union "
            + "              select p.patient_id, e.encounter_datetime data_inicio_inh from patient p "
            + "     inner join encounter e on p.patient_id=e.patient_id "
            + "     inner join obs o on o.encounter_id=e.encounter_id "
            + "              where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60 "
            + "     and e.encounter_datetime < :endDate and e.location_id=:location "
            + "  ) inicio_inh "
            + "  inner join encounter e on e.patient_id=inicio_inh.patient_id "
            + "  inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id "
            + "  inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id "
            + "  where e.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (6,9) and obsLevTPI.concept_id=6122 and obsLevTPI.value_coded in (1257,1065,1256) "
            + "        and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH) "
            + "        and e.location_id=:location and obsDTINH.voided=0 and obsDTINH.concept_id=1719 and obsDTINH.value_coded=23955 "
            + "       "
            + "       group by inicio_inh.patient_id,inicio_inh.data_inicio_inh having count(*)>=6 "
            + ") d2 on d1.patient_id=d2.patient_id "
            + " where d2.patient_id is null  ";

    public static final String findPatientsWhoCompletedINHTherapy_query3 =
        "select inicio_inh.patient_id from              "
            + " (     "
            + "       select p.patient_id, o.value_datetime data_inicio_inh              "
            + "             from  patient p           "
            + "    inner join encounter e on p.patient_id=e.patient_id             "
            + "    inner join obs o on o.encounter_id=e.encounter_id      "
            + "             where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128                "
            + "    and o.value_datetime < :endDate and e.location_id=:location     "
            + "       union          "
            + "       select p.patient_id, e.encounter_datetime data_inicio_inh    "
            + "             from  patient p           "
            + "    inner join encounter e on p.patient_id=e.patient_id             "
            + "    inner join obs o on o.encounter_id=e.encounter_id      "
            + "             where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256    "
            + "    and e.encounter_datetime < :endDate and e.location_id=:location         "
            + "       union          "
            + "       select p.patient_id, e.encounter_datetime data_inicio_inh from patient p               "
            + "             inner join encounter e on p.patient_id=e.patient_id             "
            + "             inner join obs o on o.encounter_id=e.encounter_id      "
            + "       where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60   "
            + "             and e.encounter_datetime < :endDate and e.location_id=:location         "
            + " ) inicio_inh   "
            + " inner join encounter e on e.patient_id=inicio_inh.patient_id       "
            + " inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id  "
            + " inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id and obsDTINH.voided=0              "
            + " where e.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (6,9) and obsLevTPI.concept_id=6122 and obsLevTPI.value_coded in (1257,1065,1256)   "
            + "       and obsDTINH.concept_id=1719 and obsDTINH.value_coded=23955  "
            + "       and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 5 MONTH) and e.location_id=:location   "
            + "       group by inicio_inh.patient_id,inicio_inh.data_inicio_inh having count(*)>=2 ";

    public static final String findPatientsWhoCompletedINHTherapy_query4 =
        " select  inicio_inh.patient_id from               "
            + "                 (      "
            + "             select d1.patient_id from  "
            + "( "
            + "select inicio_inh.patient_id from         "
            + "   (               "
            + "         select p.patient_id, o.value_datetime data_inicio_inh         "
            + "from  patient p      "
            + "      inner join encounter e on p.patient_id=e.patient_id        "
            + "      inner join obs o on o.encounter_id=e.encounter_id                "
            + "where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128           "
            + "      and o.value_datetime < :endDate and e.location_id=:location            "
            + "         union     "
            + "         select p.patient_id, e.encounter_datetime data_inicio_inh              "
            + "from  patient p      "
            + "      inner join encounter e on p.patient_id=e.patient_id        "
            + "      inner join obs o on o.encounter_id=e.encounter_id                "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256     "
            + "      and e.encounter_datetime < :endDate and e.location_id=:location  "
            + "         union     "
            + "         select p.patient_id, e.encounter_datetime data_inicio_inh from patient p          "
            + "inner join encounter e on p.patient_id=e.patient_id        "
            + "inner join obs o on o.encounter_id=e.encounter_id                "
            + "         where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60    "
            + "and e.encounter_datetime < :endDate and e.location_id=:location  "
            + "   ) inicio_inh            "
            + "   inner join encounter e on e.patient_id=inicio_inh.patient_id                 "
            + "   inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id                      "
            + "   where e.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (6,9) and obsLevTPI.concept_id=6122 and obsLevTPI.value_coded in (1257,1065,1256)    "
            + "         and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH) and e.location_id=:location          "
            + "         group by inicio_inh.patient_id,inicio_inh.data_inicio_inh having count(*)>=3  "
            + " ) d1 "
            + " left join  "
            + " ( "
            + "  select inicio_inh.patient_id from         "
            + "   (               "
            + "         select p.patient_id, o.value_datetime data_inicio_inh         "
            + "from  patient p      "
            + "      inner join encounter e on p.patient_id=e.patient_id        "
            + "      inner join obs o on o.encounter_id=e.encounter_id                "
            + "where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128           "
            + "      and o.value_datetime < :endDate and e.location_id=:location            "
            + "         union     "
            + "         select p.patient_id, e.encounter_datetime data_inicio_inh              "
            + "from  patient p      "
            + "      inner join encounter e on p.patient_id=e.patient_id        "
            + "      inner join obs o on o.encounter_id=e.encounter_id                "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256     "
            + "      and e.encounter_datetime < :endDate and e.location_id=:location  "
            + "         union     "
            + "         select p.patient_id, e.encounter_datetime data_inicio_inh from patient p          "
            + "inner join encounter e on p.patient_id=e.patient_id        "
            + "inner join obs o on o.encounter_id=e.encounter_id                "
            + "         where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60    "
            + "and e.encounter_datetime < :endDate and e.location_id=:location  "
            + "   ) inicio_inh            "
            + "   inner join encounter e on e.patient_id=inicio_inh.patient_id                 "
            + "   inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id            "
            + "   inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id    "
            + "   where e.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (6,9) and obsLevTPI.concept_id=6122 and obsLevTPI.value_coded in (1257,1065,1256)    "
            + "         and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH)   "
            + "         and obsDTINH.voided=0  and obsDTINH.concept_id=1719 and obsDTINH.value_coded=23955 and e.location_id=:location          "
            + "         group by inicio_inh.patient_id,inicio_inh.data_inicio_inh having count(*)>=3   "
            + " ) d2 on d1.patient_id = d2.patient_id "
            + " where d2.patient_id is null          "
            + "                 ) inicio_inh    "
            + "                 inner join      "
            + "                 (      "
            + "                       select inicio_inh.patient_id from         "
            + "                       (               "
            + "                             select p.patient_id, o.value_datetime data_inicio_inh         "
            + "                    from  patient p      "
            + "                          inner join encounter e on p.patient_id=e.patient_id        "
            + "                          inner join obs o on o.encounter_id=e.encounter_id                "
            + "                    where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128           "
            + "                          and o.value_datetime < :endDate and e.location_id=:location            "
            + "                             union     "
            + "                             select p.patient_id, e.encounter_datetime data_inicio_inh              "
            + "                    from  patient p      "
            + "                          inner join encounter e on p.patient_id=e.patient_id        "
            + "                          inner join obs o on o.encounter_id=e.encounter_id                "
            + "                    where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256     "
            + "                          and e.encounter_datetime < :endDate and e.location_id=:location  "
            + "                             union     "
            + "                             select p.patient_id, e.encounter_datetime data_inicio_inh from patient p       "
            + "                    inner join encounter e on p.patient_id=e.patient_id        "
            + "                    inner join obs o on o.encounter_id=e.encounter_id                "
            + "                             where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60    "
            + "                    and e.encounter_datetime < :endDate and e.location_id=:location  "
            + "                       ) inicio_inh            "
            + "                       inner join encounter e on e.patient_id=inicio_inh.patient_id                 "
            + "                       inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id            "
            + "                       inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id and obsDTINH.voided=0         "
            + "                       where e.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (6,9) and obsLevTPI.concept_id=6122 and obsLevTPI.value_coded in (1257,1065,1256)    "
            + "                             and obsDTINH.concept_id=1719 and obsDTINH.value_coded=23955            "
            + "                             and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH) and e.location_id=:location  "
            + "                             group by inicio_inh.patient_id,inicio_inh.data_inicio_inh having count(*)>=1  "
            + "                 ) inicio_inh_dt on inicio_inh_dt.patient_id = inicio_inh.patient_id  ";

    public static final String findPatientsWhoCompletedINHTherapy_query5 =
        "select inicio_inh.patient_id from             "
            + "(    "
            + "      select p.patient_id, o.value_datetime data_inicio_inh             "
            + "            from  patient p          "
            + "   inner join encounter e on p.patient_id=e.patient_id            "
            + "   inner join obs o on o.encounter_id=e.encounter_id     "
            + "            where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128               "
            + "   and o.value_datetime < :endDate and e.location_id=:location    "
            + "      union         "
            + "      select p.patient_id, e.encounter_datetime data_inicio_inh   "
            + "            from  patient p          "
            + "   inner join encounter e on p.patient_id=e.patient_id            "
            + "   inner join obs o on o.encounter_id=e.encounter_id     "
            + "            where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256   "
            + "   and e.encounter_datetime < :endDate and e.location_id=:location        "
            + "      union         "
            + "      select p.patient_id, e.encounter_datetime data_inicio_inh from patient p           "
            + "            inner join encounter e on p.patient_id=e.patient_id            "
            + "            inner join obs o on o.encounter_id=e.encounter_id     "
            + "      where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60  "
            + "            and e.encounter_datetime < :endDate and e.location_id=:location        "
            + ") inicio_inh  "
            + "inner join encounter e on e.patient_id=inicio_inh.patient_id      "
            + "inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id            "
            + "inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id "
            + "where e.voided=0 and obsDTINH.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (60)        "
            + "      and obsDTINH.concept_id=23986 and obsDTINH.value_coded=1098  and obsLevTPI.concept_id=23985 and obsLevTPI.value_coded in (656,23982)  "
            + "      and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH) and e.location_id=:location  "
            + "      group by inicio_inh.patient_id,inicio_inh.data_inicio_inh having count(*)>=6 "
            + "union   "
            + "select inicio_inh.patient_id from             "
            + "(    "
            + "      select p.patient_id, o.value_datetime data_inicio_inh             "
            + "            from  patient p          "
            + "   inner join encounter e on p.patient_id=e.patient_id            "
            + "   inner join obs o on o.encounter_id=e.encounter_id     "
            + "            where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128               "
            + "   and o.value_datetime < :endDate and e.location_id=:location    "
            + "      union         "
            + "      select p.patient_id, e.encounter_datetime data_inicio_inh   "
            + "            from  patient p          "
            + "   inner join encounter e on p.patient_id=e.patient_id            "
            + "   inner join obs o on o.encounter_id=e.encounter_id     "
            + "            where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256   "
            + "   and e.encounter_datetime < :endDate and e.location_id=:location        "
            + "      union         "
            + "      select p.patient_id, e.encounter_datetime data_inicio_inh from patient p              "
            + "            inner join encounter e on p.patient_id=e.patient_id            "
            + "            inner join obs o on o.encounter_id=e.encounter_id     "
            + "      where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60  "
            + "            and e.encounter_datetime < :endDate and e.location_id=:location              "
            + ") inicio_inh  "
            + "inner join encounter e on e.patient_id=inicio_inh.patient_id      "
            + "inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id            "
            + "inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id "
            + "where e.voided=0 and obsDTINH.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (60)        "
            + "      and obsDTINH.concept_id=23986 and obsDTINH.value_coded=23720  and obsLevTPI.concept_id=23985 and obsLevTPI.value_coded in (656,23982)  "
            + "      and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 5 MONTH) and e.location_id=:location  "
            + "      group by inicio_inh.patient_id,inicio_inh.data_inicio_inh having count(*)>=2 "
            + "union               "
            + "select inicio_inh.patient_id from             "
            + "(    "
            + "      select inicio_inh.patient_id from       "
            + "      (             "
            + "            select p.patient_id, o.value_datetime data_inicio_inh       "
            + "   from  patient p    "
            + "         inner join encounter e on p.patient_id=e.patient_id      "
            + "         inner join obs o on o.encounter_id=e.encounter_id              "
            + "   where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128         "
            + "         and o.value_datetime < :endDate and e.location_id=:location            "
            + "            union   "
            + "            select p.patient_id, e.encounter_datetime data_inicio_inh            "
            + "   from  patient p    "
            + "         inner join encounter e on p.patient_id=e.patient_id      "
            + "         inner join obs o on o.encounter_id=e.encounter_id              "
            + "   where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256   "
            + "         and e.encounter_datetime < :endDate and e.location_id=:location  "
            + "            union   "
            + "            select p.patient_id, e.encounter_datetime data_inicio_inh from patient p        "
            + "   inner join encounter e on p.patient_id=e.patient_id      "
            + "   inner join obs o on o.encounter_id=e.encounter_id              "
            + "            where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60  "
            + "   and e.encounter_datetime < :endDate and e.location_id=:location  "
            + "      ) inicio_inh          "
            + "      inner join encounter e on e.patient_id=inicio_inh.patient_id               "
            + "      inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id      "
            + "      inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id          "
            + "      where e.voided=0 and obsDTINH.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (60)  "
            + "            and obsDTINH.concept_id=23986 and obsDTINH.value_coded=1098  and obsLevTPI.concept_id=23985 and obsLevTPI.value_coded in (656,23982)  "
            + "            and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH) and e.location_id=:location  "
            + "            group by inicio_inh.patient_id,inicio_inh.data_inicio_inh having count(*)>=3          "
            + ") inicio_inh  "
            + "inner join    "
            + "(    "
            + "      select inicio_inh.patient_id from       "
            + "      (             "
            + "            select p.patient_id, o.value_datetime data_inicio_inh       "
            + "   from  patient p    "
            + "         inner join encounter e on p.patient_id=e.patient_id            "
            + "         inner join obs o on o.encounter_id=e.encounter_id              "
            + "   where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128         "
            + "         and o.value_datetime < :endDate and e.location_id=:location            "
            + "            union   "
            + "            select p.patient_id, e.encounter_datetime data_inicio_inh            "
            + "   from  patient p    "
            + "         inner join encounter e on p.patient_id=e.patient_id      "
            + "         inner join obs o on o.encounter_id=e.encounter_id              "
            + "   where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256   "
            + "         and e.encounter_datetime < :endDate and e.location_id=:location  "
            + "            union   "
            + "            select p.patient_id, e.encounter_datetime data_inicio_inh from patient p        "
            + "   inner join encounter e on p.patient_id=e.patient_id      "
            + "   inner join obs o on o.encounter_id=e.encounter_id              "
            + "            where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982) and e.encounter_type=60  "
            + "   and e.encounter_datetime < :endDate and e.location_id=:location  "
            + "      ) inicio_inh          "
            + "      inner join encounter e on e.patient_id=inicio_inh.patient_id               "
            + "      inner join obs obsDTINH on e.encounter_id=obsDTINH.encounter_id      "
            + "      inner join obs obsLevTPI on e.encounter_id=obsLevTPI.encounter_id          "
            + "      where e.voided=0 and obsDTINH.voided=0 and obsLevTPI.voided=0 and e.encounter_type in (60)  "
            + "            and obsDTINH.concept_id=23986 and obsDTINH.value_coded=23720  and obsLevTPI.concept_id=23985 and obsLevTPI.value_coded in (656,23982)  "
            + "            and e.encounter_datetime between inicio_inh.data_inicio_inh and (inicio_inh.data_inicio_inh + INTERVAL 7 MONTH) and e.location_id=:location  "
            + "            group by inicio_inh.patient_id,inicio_inh.data_inicio_inh having count(*)>=1 "
            + "          ) inicio_inh_dt on inicio_inh_dt.patient_id = inicio_inh.patient_id  ";
  }
}
