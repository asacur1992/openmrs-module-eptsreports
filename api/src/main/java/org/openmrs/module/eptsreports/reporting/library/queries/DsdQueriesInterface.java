package org.openmrs.module.eptsreports.reporting.library.queries;

public interface DsdQueriesInterface {
  class QUERY {

    public static final String
        findPatientsWithAdverseDrugReactionsRequiringRegularMonitoringNotifiedInLast6Months =
            "Select p.patient_id From patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "inner join obs o on e.encounter_id=o.encounter_id "
                + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id=2015 and e.encounter_type in (6,9) and e.encounter_datetime "
                + "between (:endDate - INTERVAL 6 MONTH) AND :endDate and e.location_id=:location and o.value_coded "
                + "IN (23748,6293,23749,29,23750,23751,6299,23752) group by p.patient_id ";

    public static final String findPatientsWhoHaveBeenNotifiedOfKaposiSarcoma =
        "SELECT p.patient_id FROM patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "INNER JOIN obs o ON e.encounter_id = o.encounter_id "
            + "WHERE o.concept_id=1406 AND o.value_coded = 507 AND encounter_type in (6,9) AND p.voided = 0 AND e.voided = 0 AND o.voided = 0 AND e.location_id =:location AND e.encounter_datetime<=:endDate group by p.patient_id ";

    public static final String findPatientsInArtWhoAreStable =
        "select patient_id from ( select inicio.patient_id, inicio.data_inicio, timestampdiff(year,per.birthdate,:endDate) idade, timestampdiff(month,inicio.data_inicio,:endDate) idadeEmTarv, cd4Absoluto.value_numeric cd4Abs, cd4Percentual.value_numeric cd4Per, cvmenor1000.patient_id pidcv12meses,cvmenor1000.person_id pidcvmenor100  "
            + "from (  "
            + "Select patient_id,min(data_inicio) data_inicio from ( "
            + "Select p.patient_id,min(e.encounter_datetime) data_inicio from patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on o.encounter_id=e.encounter_id  "
            + "where e.voided=0 and o.voided=0 and p.voided=0 and  e.encounter_type in (18,6,9) and o.concept_id=1255 and o.value_coded=1256 and  e.encounter_datetime<=:endDate and e.location_id=:location group by p.patient_id  "
            + "union  "
            + "Select p.patient_id,min(value_datetime) data_inicio from patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on e.encounter_id=o.encounter_id  "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (18,6,9,53) and  o.concept_id=1190 and o.value_datetime is not null and  o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id  "
            + "union  "
            + "select pg.patient_id,min(date_enrolled) data_inicio from patient p  "
            + "inner join patient_program pg on p.patient_id=pg.patient_id where pg.voided=0 and p.voided=0 and program_id=2 and date_enrolled<=:endDate and location_id=:location group by pg.patient_id  "
            + "union  "
            + "SELECT e.patient_id, MIN(e.encounter_datetime) AS data_inicio  FROM patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "WHERE p.voided=0 and e.encounter_type=18 AND e.voided=0 and e.encounter_datetime<=:endDate and e.location_id=:location GROUP BY p.patient_id  "
            + "union  "
            + "Select p.patient_id,min(value_datetime) data_inicio from patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on e.encounter_id=o.encounter_id  "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=52 and  o.concept_id=23866 and o.value_datetime is not null and  o.value_datetime<=:endDate and e.location_id=:location group by p.patient_id) inicio_real group by patient_id  "
            + ") inicio  "
            + "inner join person per on per.person_id=inicio.patient_id and per.voided=0  "
            + "left join  "
            + "( "
            + "select distinct max_cv.patient_id,o.person_id  from (  "
            + "Select p.patient_id,max(o.obs_datetime) max_data_cv  From patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on e.encounter_id=o.encounter_id  "
            + "where  p.voided=0 and e.voided=0 and o.voided=0 and concept_id in (856,1305) and  e.encounter_type in (6,9,13,51,53) and o.obs_datetime between (:endDate - INTERVAL 12 MONTH) AND :endDate and e.location_id=:location  "
            + "group by p.patient_id "
            + ")max_cv  "
            + "left join obs o on o.person_id=max_cv.patient_id and max_cv.max_data_cv=o.obs_datetime and o.voided=0 and  "
            + "((o.concept_id=856 and o.value_numeric<1000) or (o.concept_id=1305 and o.value_coded in (1306,23814,23905,23906,23907,23908,23904))) and o.location_id=:location ) cvmenor1000 on inicio.patient_id=cvmenor1000.patient_id  "
            + "left join ( "
            + "select distinct max_cd4.patient_id,o.value_numeric  from (  "
            + "Select p.patient_id,max(o.obs_datetime) max_data_cd4  From patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on e.encounter_id=o.encounter_id  "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id in (1695,5497) and  e.encounter_type in (6,9,13,53) and o.obs_datetime between (:endDate - INTERVAL 12 MONTH) AND :endDate and e.location_id=:location group by p.patient_id "
            + ")max_cd4  "
            + "left join obs o on o.person_id=max_cd4.patient_id and max_cd4.max_data_cd4=o.obs_datetime and o.voided=0 and  "
            + "o.concept_id in (1695,5497) and o.value_numeric>200 and o.location_id=:location "
            + ") cd4Absoluto on inicio.patient_id=cd4Absoluto.patient_id  "
            + "left join  ( "
            + "select distinct max_cd4.patient_id,o.value_numeric  from ( "
            + "Select p.patient_id,max(o.obs_datetime) max_data_cd4  From patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on e.encounter_id=o.encounter_id  "
            + "where 	p.voided=0 and e.voided=0 and o.voided=0 and concept_id=730 and  e.encounter_type in (6,9,13) and o.obs_datetime between (:endDate - INTERVAL 12 MONTH) AND :endDate and e.location_id=:location  "
            + "group by p.patient_id "
            + ") max_cd4  "
            + "left join obs o on o.person_id=max_cd4.patient_id and max_cd4.max_data_cd4=o.obs_datetime and o.voided=0 and  "
            + "o.concept_id=730 and o.value_numeric>15 and o.location_id=:location "
            + ") cd4Percentual on inicio.patient_id=cd4Percentual.patient_id "
            + ") elegivel  "
            + "where idade>=2 and ((idade<=9 and idadeEmTarv>=12) or (idade>=10 and idadeEmTarv>=6)) and ((pidcvmenor100 is not null ) or (pidcv12meses is null and idade>=5 and cd4Abs>200) or (pidcv12meses is null and idade<=4 and (cd4Abs>750 or cd4Per>15))) ";

    public static final String findPatietsWhoAreOnAdherenceClubs =
        "select maxEnc.patient_id from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate  "
            + "group by p.patient_id  "
            + ")maxEnc  "
            + "inner join  "
            + "(  "
            + "select max_ficha.patient_id, max_ficha.data_mdc from   (  "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p  "
            + "join encounter e on p.patient_id=e.patient_id  "
            + "join obs grupo on grupo.encounter_id=e.encounter_id  "
            + "join obs o on o.encounter_id=e.encounter_id  "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id  "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23726) and o.voided=0  "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257)  "
            + "and obsEstado.voided=0  and grupo.voided=0  "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate  "
            + "group by p.patient_id  "
            + ") max_ficha  "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id  "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc  "
            + "group by maxEnc.patient_id  ";

    public static final String findPatientsWhoAreThreeMonthsDrugDistribution =
        "select patient_id from ( "
            + "select patient_id, data_mdc, ordemSource from ( "
            + "select patient_id,data_levantamento data_mdc, 1 as ordemSource from ( "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  ( "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime <=:endDate "
            + "group by p.patient_id "
            + ")fila "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
            + "and obs_fila.concept_id=5096   and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 83 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 97) "
            + "group by fila.patient_id "
            + ") fila "
            + "union "
            + "select fc.patient_id, fc.max_datagaac data_mdc, 2 as ordemSource from( "
            + "select maxEnc.patient_id,max_datagaac from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate "
            + "group by p.patient_id "
            + ")maxEnc "
            + "inner join "
            + "( "
            + "select max_ficha.patient_id, max_ficha.data_mdc from  ( "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p "
            + "join encounter e on p.patient_id=e.patient_id "
            + "join obs grupo on grupo.encounter_id=e.encounter_id "
            + "join obs o on o.encounter_id=e.encounter_id "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23730) and o.voided=0 "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257) "
            + "and obsEstado.voided=0  and grupo.voided=0 "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate "
            + "group by p.patient_id "
            + ") max_ficha "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc "
            + "order by maxEnc.patient_id "
            + ")fc "
            + "union "
            + "select max_tipo_despensa.patient_id, max_tipo_despensa.data_mdc, 2 as ordemSource from  ( "
            + "select max_tl.patient_id,max_tl.data_mdc from   ( "
            + "select p.patient_id,max(e.encounter_datetime) as data_mdc from patient p "
            + "join encounter e on p.patient_id=e.patient_id "
            + "where e.encounter_type=6 and e.voided=0  and p.voided=0  and e.location_id=:location "
            + "and DATE(e.encounter_datetime) <=:endDate "
            + "group by p.patient_id "
            + ") max_tl "
            + "join obs on obs.person_id=max_tl.patient_id and max_tl.data_mdc=obs.obs_datetime "
            + "where obs.concept_id=23739 and obs.value_coded in(23720) and obs.voided=0 and obs.location_id=:location "
            + ") max_tipo_despensa "
            + ") dt order by dt.patient_id, data_mdc desc, ordemSource "
            + ") dtFinal group by dtFinal.patient_id ";

    public static final String findPatientsWhoAreFastTrack =
        "select patient_id from ( "
            + "select maxEnc.patient_id from      "
            + "( "
            + "select p.patient_id,max(e.encounter_datetime) data_seguimento from patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on o.encounter_id=e.encounter_id  "
            + "where e.encounter_type in(6,9) and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate "
            + "group by p.patient_id  "
            + ")maxEnc  "
            + "left join  obs obs_seguimento on obs_seguimento.person_id=maxEnc.patient_id "
            + "and obs_seguimento.voided=0 "
            + "and obs_seguimento.obs_datetime=maxEnc.data_seguimento "
            + "and obs_seguimento.concept_id=1410 "
            + "and obs_seguimento.location_id=:location  "
            + "where DATEDIFF(obs_seguimento.value_datetime,maxEnc.data_seguimento) >= 175 and DATEDIFF(obs_seguimento.value_datetime,maxEnc.data_seguimento)  <= 190 "
            + ")fc "
            + "union "
            + "select patient_id from ( "
            + "select maxEnc.patient_id from  (  "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on o.encounter_id=e.encounter_id  "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate "
            + "group by p.patient_id  "
            + ")maxEnc "
            + "inner join ( "
            + "select max_ficha.patient_id, max_ficha.data_mdc from  "
            + "(  "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p   "
            + "join encounter e on p.patient_id=e.patient_id   "
            + "join obs grupo on grupo.encounter_id=e.encounter_id   "
            + "join obs o on o.encounter_id=e.encounter_id  "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id   "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23729) and o.voided=0   "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257)   "
            + "and obsEstado.voided=0  and grupo.voided=0   "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate "
            + "group by p.patient_id  "
            + ") max_ficha  "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc "
            + "order by maxEnc.patient_id "
            + ") fc";

    public static final String findPatientsWhoAreInCommunityDrugsDistribution =
        "select patient_id from ( "
            + "select patient_id, data_mdc, orderSource from ( "
            + "select patient_id, data_levantamento data_mdc, 1 as orderSource from ( "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  ( "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime <=:endDate "
            + "group by p.patient_id "
            + ")fila "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
            + "and obs_fila.concept_id=165174  and obs_fila.value_coded=165179  and obs_fila.location_id=:location "
            + "group by fila.patient_id "
            + ") fila "
            + "union "
            + "select fc.patient_id, fc.max_datagaac as data_mdc, 2 as orderSource from( "
            + "select maxEnc.patient_id, max_datagaac from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate "
            + "group by p.patient_id "
            + ")maxEnc "
            + "inner join "
            + "( "
            + "select max_ficha.patient_id, max_ficha.data_mdc from  ( "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p "
            + "join encounter e on p.patient_id=e.patient_id "
            + "join obs grupo on grupo.encounter_id=e.encounter_id "
            + "join obs o on o.encounter_id=e.encounter_id "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(165179) and o.voided=0 "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257) "
            + "and obsEstado.voided=0  and grupo.voided=0 "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate "
            + "group by p.patient_id "
            + ") max_ficha "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc "
            + "order by maxEnc.patient_id "
            + ")fc "
            + ") dc order by patient_id, data_mdc desc, orderSource "
            + ")dcFinal group by patient_id ";

    public static String findPatientWhoAreAnyMDC(int conceptId) {
      String query =
          "select maxEnc.patient_id from  (  "
              + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p  "
              + "inner join encounter e on p.patient_id=e.patient_id  "
              + "inner join obs o on o.encounter_id=e.encounter_id  "
              + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate "
              + "group by p.patient_id  "
              + ")maxEnc "
              + "inner join ( "
              + "select max_ficha.patient_id, max_ficha.data_mdc from  "
              + "(  "
              + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p   "
              + "join encounter e on p.patient_id=e.patient_id   "
              + "join obs grupo on grupo.encounter_id=e.encounter_id   "
              + "join obs o on o.encounter_id=e.encounter_id  "
              + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id   "
              + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(%s) and o.voided=0   "
              + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257)   "
              + "and obsEstado.voided=0  and grupo.voided=0   "
              + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate "
              + "group by p.patient_id  "
              + ") max_ficha  "
              + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id "
              + "where maxEnc.max_datagaac=max_ficha.data_mdc "
              + "order by maxEnc.patient_id ";

      return String.format(query, conceptId);
    }

    public static final String findPatientsWhoAreCommunityAdherenceGroups =
        "select patient_id from( "
            + "Select gm.member_id as patient_id from gaac g "
            + "inner join gaac_member gm on g.gaac_id=gm.gaac_id "
            + "where gm.start_date<=:endDate and gm.voided=0 and g.voided=0 and ((leaving is null) or (leaving=0) or (leaving=1 and gm.end_date>:endDate)) and location_id=:location "
            + "union "
            + "select max_gaac.patient_id from( "
            + "select p.patient_id,max(o.obs_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23724 and e.location_id=:location and o.obs_datetime<=:endDate "
            + "group by p.patient_id "
            + ") max_gaac "
            + "inner join encounter e on e.patient_id=max_gaac.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where  max_gaac.max_datagaac=obs.obs_datetime and obs.concept_id=23724 and obs.value_coded in (1256,1257) and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") gaac  "
            + "where patient_id not in( "
            + "select max_gaac.patient_id from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23724 and e.location_id=:location and o.obs_datetime<=:endDate group by p.patient_id "
            + ")max_gaac "
            + "inner join encounter e on e.patient_id=max_gaac.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id  "
            + "where max_gaac.max_datagaac=obs.obs_datetime and obs.concept_id=23724 and obs.value_coded=1267 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") ";

    public static final String findPatientsWhoAreFamilyAproach =
        "select maxEnc.patient_id from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate  "
            + "group by p.patient_id  "
            + ")maxEnc  "
            + "inner join  "
            + "(  "
            + "select max_ficha.patient_id, max_ficha.data_mdc from   (  "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p  "
            + "join encounter e on p.patient_id=e.patient_id  "
            + "join obs grupo on grupo.encounter_id=e.encounter_id  "
            + "join obs o on o.encounter_id=e.encounter_id  "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id  "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23725) and o.voided=0  "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257)  "
            + "and obsEstado.voided=0  and grupo.voided=0  "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate  "
            + "group by p.patient_id  "
            + ") max_ficha  "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id  "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc  "
            + "group by maxEnc.patient_id  ";

    public static final String findPatientsWhoAreSixMonthsDrugsDistribution =
        "select patient_id from ( "
            + "select  patient_id, data_mdc, orderSource from ( "
            + "select patient_id, data_levantamento data_mdc, 1 as orderSource from ( "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  ( "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime <=:endDate "
            + "group by p.patient_id "
            + ")fila "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
            + "and obs_fila.concept_id=5096   and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 175 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 190) "
            + "group by fila.patient_id "
            + ") fila "
            + "union "
            + "select fc.patient_id, fc.max_datagaac, 2 as orderSource from( "
            + "select maxEnc.patient_id, max_datagaac from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate "
            + "group by p.patient_id "
            + ")maxEnc "
            + "inner join "
            + "( "
            + "select max_ficha.patient_id, max_ficha.data_mdc from  ( "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p "
            + "join encounter e on p.patient_id=e.patient_id "
            + "join obs grupo on grupo.encounter_id=e.encounter_id "
            + "join obs o on o.encounter_id=e.encounter_id "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(23888) and o.voided=0 "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257) "
            + "and obsEstado.voided=0  and grupo.voided=0 "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate "
            + "group by p.patient_id "
            + ") max_ficha "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc "
            + "order by maxEnc.patient_id "
            + ")fc "
            + "union "
            + "select max_tipo_despensa.patient_id, data_mdc, 2 as orderSource from  ( "
            + "select max_tl.patient_id,max_tl.data_mdc from   ( "
            + "select p.patient_id,max(e.encounter_datetime) as data_mdc from patient p "
            + "join encounter e on p.patient_id=e.patient_id "
            + "where e.encounter_type=6 and e.voided=0  and p.voided=0  and e.location_id=:location "
            + "and DATE(e.encounter_datetime) <=:endDate "
            + "group by p.patient_id "
            + ") max_tl "
            + "join obs on obs.person_id=max_tl.patient_id and max_tl.data_mdc=obs.obs_datetime "
            + "where obs.concept_id=23739 and obs.value_coded in(23888) and obs.voided=0 and obs.location_id=:location "
            + ") max_tipo_despensa "
            + ") ds order by ds.patient_id, ds.data_mdc desc, orderSource "
            + ") dsFinal group by patient_id ";

    public static final String findPatientsWhoAreAnnualDrugsDistribution =
        "select patient_id from ( "
            + "select patient_id, data_mdc, orderSource from ( "
            + "select patient_id, data_levantamento data_mdc, 1 as orderSource from ( "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  ( "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime <=:endDate "
            + "group by p.patient_id "
            + ")fila "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
            + "and obs_fila.concept_id=5096   and obs_fila.location_id=:location "
            + "and (DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) >= 335 and DATEDIFF(obs_fila.value_datetime,fila.data_levantamento) <= 395) "
            + "group by fila.patient_id "
            + ") fila "
            + "union "
            + "select fc.patient_id, fc.max_datagaac as data_mdc, 2 as orderSource from( "
            + "select maxEnc.patient_id, max_datagaac from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate "
            + "group by p.patient_id "
            + ")maxEnc "
            + "inner join "
            + "( "
            + "select max_ficha.patient_id, max_ficha.data_mdc from  ( "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p "
            + "join encounter e on p.patient_id=e.patient_id "
            + "join obs grupo on grupo.encounter_id=e.encounter_id "
            + "join obs o on o.encounter_id=e.encounter_id "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(165314) and o.voided=0 "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257) "
            + "and obsEstado.voided=0  and grupo.voided=0 "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate "
            + "group by p.patient_id "
            + ") max_ficha "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc "
            + "order by maxEnc.patient_id "
            + ")fc "
            + ") da order by patient_id, data_mdc desc, orderSource "
            + ") daFinal group by daFinal.patient_id ";

    public static final String findPatientsWhoAreDiscentralazedDrugsDistribution =
        "select patient_id from ( "
            + "select patient_id, data_mdc, orderSource from ( "
            + "select patient_id, data_levantamento data_mdc, 1 as orderSource from ( "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  ( "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime <=:endDate "
            + "group by p.patient_id "
            + ")fila "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
            + "and obs_fila.concept_id=165174  and obs_fila.value_coded=165177  and obs_fila.location_id=:location "
            + "group by fila.patient_id "
            + ") fila "
            + "union "
            + "select fc.patient_id, fc.max_datagaac data_mdc, 2 as orderSource from( "
            + "select maxEnc.patient_id, max_datagaac from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate "
            + "group by p.patient_id "
            + ")maxEnc "
            + "inner join "
            + "( "
            + "select max_ficha.patient_id, max_ficha.data_mdc from  ( "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p "
            + "join encounter e on p.patient_id=e.patient_id "
            + "join obs grupo on grupo.encounter_id=e.encounter_id "
            + "join obs o on o.encounter_id=e.encounter_id "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(165315) and o.voided=0 "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257) "
            + "and obsEstado.voided=0  and grupo.voided=0 "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate "
            + "group by p.patient_id "
            + ") max_ficha "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc "
            + "order by maxEnc.patient_id "
            + ")fc "
            + ") dd order by  patient_id, data_mdc desc, orderSource "
            + ") ddFinal group by patient_id ";

    public static final String findPatientsWhoAreMobileClinic =
        "select patient_id from ( "
            + "select patient_id, data_mdc, ordemSource from ( "
            + "select patient_id,data_levantamento data_mdc, 1 as ordemSource from ( "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  ( "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime <=:endDate "
            + "group by p.patient_id "
            + ")fila "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
            + "and obs_fila.concept_id=165174  and obs_fila.value_coded in(165183,165182) and obs_fila.location_id=:location "
            + "group by fila.patient_id "
            + ") fila "
            + "union "
            + "select fc.patient_id, fc.max_datagaac data_mdc, 2 as ordemSource from( "
            + "select maxEnc.patient_id,max_datagaac from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate "
            + "group by p.patient_id "
            + ")maxEnc "
            + "inner join "
            + "( "
            + "select max_ficha.patient_id, max_ficha.data_mdc from  ( "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p "
            + "join encounter e on p.patient_id=e.patient_id "
            + "join obs grupo on grupo.encounter_id=e.encounter_id "
            + "join obs o on o.encounter_id=e.encounter_id "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(165265) and o.voided=0 "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257) "
            + "and obsEstado.voided=0  and grupo.voided=0 "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate "
            + "group by p.patient_id "
            + ") max_ficha "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc "
            + "order by maxEnc.patient_id "
            + ")fc "
            + ") mc order by mc.patient_id, data_mdc desc, ordemSource "
            + ") mcFinal group by mcFinal.patient_id ";

    public static final String findPatientsWhoAreMobileBrigades =
        "select patient_id from ( "
            + "select patient_id, data_mdc, ordemSource from ( "
            + "select patient_id,data_levantamento data_mdc, 1 as ordemSource from ( "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  ( "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime <=:endDate "
            + "group by p.patient_id "
            + ")fila "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
            + "and obs_fila.concept_id=165174  and obs_fila.value_coded in(165180,165181) and obs_fila.location_id=:location "
            + "group by fila.patient_id "
            + ") fila "
            + "union "
            + "select fc.patient_id, fc.max_datagaac data_mdc, 2 as ordemSource from( "
            + "select maxEnc.patient_id,max_datagaac from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate "
            + "group by p.patient_id "
            + ")maxEnc "
            + "inner join "
            + "( "
            + "select max_ficha.patient_id, max_ficha.data_mdc from  ( "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p "
            + "join encounter e on p.patient_id=e.patient_id "
            + "join obs grupo on grupo.encounter_id=e.encounter_id "
            + "join obs o on o.encounter_id=e.encounter_id "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(165264) and o.voided=0 "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257) "
            + "and obsEstado.voided=0  and grupo.voided=0 "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate "
            + "group by p.patient_id "
            + ") max_ficha "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc "
            + "order by maxEnc.patient_id "
            + ")fc "
            + ") mc order by mc.patient_id, data_mdc desc, ordemSource "
            + ") mcFinal group by mcFinal.patient_id ";

    public static final String findPatientsWhoAreInCommunityDrugsDistributionViaProvider =
        "select patient_id from ( "
            + "select patient_id, data_mdc, orderSource from ( "
            + "select patient_id, data_levantamento data_mdc, 1 as orderSource from ( "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento,obs_fila.value_datetime data_proximo_levantamento  from  ( "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime <=:endDate "
            + "group by p.patient_id "
            + ")fila "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
            + "and obs_fila.concept_id=165174  and obs_fila.value_coded=165178  and obs_fila.location_id=:location "
            + "group by fila.patient_id "
            + ") fila "
            + "union "
            + "select fc.patient_id, fc.max_datagaac as data_mdc, 2 as orderSource from( "
            + "select maxEnc.patient_id, max_datagaac from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate "
            + "group by p.patient_id "
            + ")maxEnc "
            + "inner join "
            + "( "
            + "select max_ficha.patient_id, max_ficha.data_mdc from  ( "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p "
            + "join encounter e on p.patient_id=e.patient_id "
            + "join obs grupo on grupo.encounter_id=e.encounter_id "
            + "join obs o on o.encounter_id=e.encounter_id "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(165178) and o.voided=0 "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257) "
            + "and obsEstado.voided=0  and grupo.voided=0 "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate "
            + "group by p.patient_id "
            + ") max_ficha "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc "
            + "order by maxEnc.patient_id "
            + ")fc "
            + ") dcProvider order by patient_id, data_mdc desc, orderSource "
            + ")dcProviderFinal group by patient_id ";

    public static final String findPatientsWhoAreInTimeExtetion =
        "select patient_id from ( "
            + "select patient_id, data_mdc, orderSource from ( "
            + "select patient_id, data_levantamento data_mdc, 1 as orderSource from ( "
            + "select fila.patient_id,max(fila.data_levantamento) data_levantamento  from  ( "
            + "Select p.patient_id,max(encounter_datetime) data_levantamento  from  patient p "
            + "inner join encounter e on e.patient_id=p.patient_id "
            + "where  p.voided=0 and e.voided=0 and e.encounter_type=18 and e.location_id=:location "
            + "and e.encounter_datetime <=:endDate "
            + "group by p.patient_id "
            + ")fila "
            + "inner join  obs obs_fila on obs_fila.person_id=fila.patient_id "
            + "and obs_fila.voided=0  and obs_fila.obs_datetime=fila.data_levantamento "
            + "and obs_fila.concept_id=165174  and obs_fila.value_coded=165176  and obs_fila.location_id=:location "
            + "group by fila.patient_id "
            + ") fila "
            + "union "
            + "select fc.patient_id, fc.max_datagaac as data_mdc, 2 as orderSource from( "
            + "select maxEnc.patient_id, max_datagaac from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate "
            + "group by p.patient_id "
            + ")maxEnc "
            + "inner join "
            + "( "
            + "select max_ficha.patient_id, max_ficha.data_mdc from  ( "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p "
            + "join encounter e on p.patient_id=e.patient_id "
            + "join obs grupo on grupo.encounter_id=e.encounter_id "
            + "join obs o on o.encounter_id=e.encounter_id "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(165316) and o.voided=0 "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257) "
            + "and obsEstado.voided=0  and grupo.voided=0 "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate "
            + "group by p.patient_id "
            + ") max_ficha "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc "
            + "order by maxEnc.patient_id "
            + ")fc "
            + ") eh order by patient_id, data_mdc desc, orderSource "
            + ")ehProviderFinal group by patient_id ";

    public static final String findPatientsWhoAreTBSector =
        "select maxEnc.patient_id from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate  "
            + "group by p.patient_id  "
            + ")maxEnc  "
            + "inner join  "
            + "(  "
            + "select max_ficha.patient_id, max_ficha.data_mdc from   (  "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p  "
            + "join encounter e on p.patient_id=e.patient_id  "
            + "join obs grupo on grupo.encounter_id=e.encounter_id  "
            + "join obs o on o.encounter_id=e.encounter_id  "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id  "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(165317) and o.voided=0  "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257)  "
            + "and obsEstado.voided=0  and grupo.voided=0  "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate  "
            + "group by p.patient_id  "
            + ") max_ficha  "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id  "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc  "
            + "group by maxEnc.patient_id  ";

    public static final String findPatientsWhoAreOneStopAtARTServices =
        "select maxEnc.patient_id from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate  "
            + "group by p.patient_id  "
            + ")maxEnc  "
            + "inner join  "
            + "(  "
            + "select max_ficha.patient_id, max_ficha.data_mdc from   (  "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p  "
            + "join encounter e on p.patient_id=e.patient_id  "
            + "join obs grupo on grupo.encounter_id=e.encounter_id  "
            + "join obs o on o.encounter_id=e.encounter_id  "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id  "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(165318) and o.voided=0  "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257)  "
            + "and obsEstado.voided=0  and grupo.voided=0  "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate  "
            + "group by p.patient_id  "
            + ") max_ficha  "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id  "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc  "
            + "group by maxEnc.patient_id  ";

    public static final String findPatientsWhoAreOneStopAtARTServicesSMI =
        "select maxEnc.patient_id from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate  "
            + "group by p.patient_id  "
            + ")maxEnc  "
            + "inner join  "
            + "(  "
            + "select max_ficha.patient_id, max_ficha.data_mdc from   (  "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p  "
            + "join encounter e on p.patient_id=e.patient_id  "
            + "join obs grupo on grupo.encounter_id=e.encounter_id  "
            + "join obs o on o.encounter_id=e.encounter_id  "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id  "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(165320) and o.voided=0  "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257)  "
            + "and obsEstado.voided=0  and grupo.voided=0  "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate  "
            + "group by p.patient_id  "
            + ") max_ficha  "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id  "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc  "
            + "group by maxEnc.patient_id  ";

    public static final String findPatientsWhoAreOneSAAJ =
        "select maxEnc.patient_id from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate  "
            + "group by p.patient_id  "
            + ")maxEnc  "
            + "inner join  "
            + "(  "
            + "select max_ficha.patient_id, max_ficha.data_mdc from   (  "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p  "
            + "join encounter e on p.patient_id=e.patient_id  "
            + "join obs grupo on grupo.encounter_id=e.encounter_id  "
            + "join obs o on o.encounter_id=e.encounter_id  "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id  "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(165319) and o.voided=0  "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257)  "
            + "and obsEstado.voided=0  and grupo.voided=0  "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate  "
            + "group by p.patient_id  "
            + ") max_ficha  "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id  "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc  "
            + "group by maxEnc.patient_id  ";

    public static final String findPatientsWhoAreOneAdvancedHIVDisease =
        "select maxEnc.patient_id from ( "
            + "select p.patient_id,max(e.encounter_datetime) max_datagaac from patient p  "
            + "inner join encounter e on p.patient_id=e.patient_id  "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0  and e.location_id=:location and o.obs_datetime<=:endDate  "
            + "group by p.patient_id  "
            + ")maxEnc  "
            + "inner join  "
            + "(  "
            + "select max_ficha.patient_id, max_ficha.data_mdc from   (  "
            + "select p.patient_id,obsEstado.obs_datetime data_mdc from patient p  "
            + "join encounter e on p.patient_id=e.patient_id  "
            + "join obs grupo on grupo.encounter_id=e.encounter_id  "
            + "join obs o on o.encounter_id=e.encounter_id  "
            + "join obs obsEstado on obsEstado.encounter_id=e.encounter_id  "
            + "where  e.encounter_type in(6) and e.location_id=:location and o.concept_id=165174 and o.value_coded in(165321) and o.voided=0  "
            + "and grupo.concept_id=165323  and grupo.voided=0 and obsEstado.concept_id=165322  and obsEstado.value_coded in(1256,1257)  "
            + "and obsEstado.voided=0  and grupo.voided=0  "
            + "and grupo.obs_id=o.obs_group_id and grupo.obs_id=obsEstado.obs_group_id  and e.encounter_datetime<=:endDate  "
            + "group by p.patient_id  "
            + ") max_ficha  "
            + ")max_ficha on max_ficha.patient_id=maxEnc.patient_id  "
            + "where maxEnc.max_datagaac=max_ficha.data_mdc  "
            + "group by maxEnc.patient_id  ";

    public static final String findPatientsAgeRange =
        "SELECT patient_id FROM patient "
            + "INNER JOIN person ON patient_id = person_id WHERE patient.voided=0 AND person.voided=0 "
            + "AND TIMESTAMPDIFF(year,birthdate,:endDate) BETWEEN %d AND %d AND birthdate IS NOT NULL";

    public static final String findPatientsWhoWhereTransferredInPriorReportingPeriod =
        "														"
            + "select  max_estado.patient_id                                                                                                    "
            + "from(                                                                                                                             "
            + "  select pg.patient_id,                                                                                                           "
            + "      max(ps.start_date) data_estado                                                                                              "
            + "    from  patient p                                                                                                               "
            + "      inner join patient_program pg on p.patient_id = pg.patient_id                                                               "
            + "      inner join patient_state ps on pg.patient_program_id = ps.patient_program_id                                                "
            + "    where pg.voided=0 and ps.voided=0 and p.voided=0  and pg.program_id = 2                                                       "
            + "      and ps.start_date>=:startDate and  ps.start_date< :endDate and pg.location_id =:location group by pg.patient_id             "
            + "    )                                                                                                                             "
            + "max_estado                                                                                                                        "
            + "  inner join patient_program pp on pp.patient_id = max_estado.patient_id                                                          "
            + "  inner join patient_state ps on ps.patient_program_id = pp.patient_program_id and ps.start_date = max_estado.data_estado         "
            + "where pp.program_id = 2 and ps.state = 29 and pp.voided = 0 and ps.voided = 0 and pp.location_id = :location                      "
            + "union                                                                                                                             "
            + "select transferido_de.patient_id                                                                                                  "
            + "from(                                                                                                                             "
            + "  select p.patient_id, max(obsOpenDate.value_datetime) data_estado from patient p                                                 "
            + "    inner join encounter e on p.patient_id=e.patient_id                                                                           "
            + "    inner join obs obsTransIn on e.encounter_id= obsTransIn.encounter_id                                                          "
            + "    inner join obs obsOpenDate on e.encounter_id= obsOpenDate.encounter_id                                                        "
            + "    inner join obs obsInTarv on e.encounter_id= obsInTarv.encounter_id                                                            "
            + "   where e.voided=0 and obsTransIn.voided=0 and p.voided=0  and obsOpenDate.voided =0 and obsInTarv.voided =0                     "
            + "    and e.encounter_type=53 and obsTransIn.concept_id=1369 and obsTransIn.value_coded=1065                                        "
            + "    and obsOpenDate.concept_id=23891 and obsOpenDate.value_datetime is not null                                                   "
            + "    and obsInTarv.concept_id=6300 and obsInTarv.value_coded=6276                                                                  "
            + "    and obsOpenDate.value_datetime >=:startDate and obsOpenDate.value_datetime < :endDate and e.location_id=:location group by p.patient_id  "
            + ") transferido_de                                                                                                                                ";
  }
}
