package org.openmrs.module.eptsreports.reporting.library.queries;

public interface DSDQueriesInterfaceMQCategory14 {

  class QUERY {

    public static final String findPatientsWhoAreCommunityAdherenceGroups =
        "select gaac.patient_id from ( "
            + "select patient_id,max_datagaac from( "
            + "Select gm.member_id as patient_id,gm.start_date max_datagaac from gaac g "
            + "inner join gaac_member gm on g.gaac_id=gm.gaac_id "
            + "where gm.start_date<=:endDate and gm.voided=0 and g.voided=0 and ((leaving is null) or (leaving=0) or (leaving=1 and gm.end_date>:endDate)) and location_id=:location "
            + "union "
            + "select max_gaac.patient_id,max_datagaac from( "
            + "select p.patient_id,max(o.obs_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23724 and e.location_id=:location and o.obs_datetime<=:endDate "
            + "group by p.patient_id "
            + ") max_gaac "
            + "inner join encounter e on e.patient_id=max_gaac.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where  max_gaac.max_datagaac=obs.obs_datetime and obs.concept_id=23724 and obs.value_coded in (1256,1257) and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") gaac "
            + "where patient_id not in( "
            + "select max_gaac.patient_id from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23724 and e.location_id=:location and o.obs_datetime<=:endDate group by p.patient_id "
            + ")max_gaac "
            + "inner join encounter e on e.patient_id=max_gaac.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_gaac.max_datagaac=obs.obs_datetime and obs.concept_id=23724 and obs.value_coded=1267 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ")) gaac "
            + "inner join ( "
            + "Select p.patient_id,max(o.obs_datetime) data_carga from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on e.encounter_id=o.encounter_id "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and "
            + "e.encounter_type = 6 and  o.concept_id in (856,1305) and  o.obs_datetime <= :endDate and e.location_id=:location group by p.patient_id) carga_viral on gaac.patient_id=carga_viral.patient_id "
            + "where max_datagaac between date_add(carga_viral.data_carga, interval -12 MONTH) and carga_viral.data_carga ";

    public static final String findPatientsWhoAreThreeMonthsDrugDistribution =
        "select dispensa_trimestral.patient_id from ( "
            + "select patient_id,max_datatl from ( "
            + "select max_tl.patient_id,max_datatl from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datatl from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location and o.obs_datetime<=:endDate group by p.patient_id) max_tl "
            + "inner join obs on obs.person_id=max_tl.patient_id and max_tl.max_datatl=obs.obs_datetime "
            + "where obs.concept_id=23739 and obs.value_coded=23720 and obs.voided=0 and obs.location_id=:location "
            + "union "
            + "select max_dt.patient_id,max_datadt from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datadt from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23730 and e.location_id=:location and o.obs_datetime<=:endDate group by p.patient_id "
            + ") max_dt "
            + "inner join encounter e on e.patient_id=max_dt.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dt.max_datadt=obs.obs_datetime and obs.concept_id=23730 and obs.value_coded in (1256,1257) and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") dt "
            + "where patient_id not in (select max_dts.patient_id from( "
            + "select p.patient_id,max(o.obs_datetime) max_datadts from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23730 and e.location_id=:location and o.obs_datetime<=:endDate group by p.patient_id "
            + ") max_dts "
            + "inner join encounter e on e.patient_id=max_dts.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dts.max_datadts=obs.obs_datetime and obs.concept_id=23730 and obs.value_coded=1267 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ")) dispensa_trimestral "
            + "inner join ( "
            + "Select p.patient_id,max(o.obs_datetime) data_carga from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on e.encounter_id=o.encounter_id "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and "
            + "e.encounter_type = 6 and  o.concept_id in (856,1305) and  o.obs_datetime <= :endDate and e.location_id=:location group by p.patient_id) carga_viral on dispensa_trimestral.patient_id=carga_viral.patient_id "
            + "where dispensa_trimestral.max_datatl between date_add(carga_viral.data_carga, interval -12 MONTH) and carga_viral.data_carga ";

    public static final String findPatientsWhoAreSixMonthsDrugsDistribution =
        "select dispensa_semestral.patient_id from ( "
            + "select patient_id,max_datatl from( "
            + "select max_tl.patient_id,max_tl.max_datatl from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datatl from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location and o.obs_datetime<=:endDate group by p.patient_id "
            + ") max_tl "
            + "inner join obs on obs.person_id=max_tl.patient_id and max_tl.max_datatl=obs.obs_datetime "
            + "where obs.concept_id=23739 and obs.value_coded=23888 and obs.voided=0 and obs.location_id=:location union "
            + "select max_dt.patient_id,max_datadt from( "
            + "select p.patient_id,max(o.obs_datetime) max_datadt from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23888 and e.location_id=:location and o.obs_datetime<=:endDate group by p.patient_id "
            + ") max_dt "
            + "inner join encounter e on e.patient_id=max_dt.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dt.max_datadt=obs.obs_datetime and obs.concept_id=23888 and obs.voided=0 and obs.value_coded in (1256,1257) and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") dt "
            + "where patient_id not in( "
            + "select max_dts.patient_id from( "
            + "select p.patient_id,max(o.obs_datetime) max_datadts from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23888 and e.location_id=:location and o.obs_datetime<=:endDate group by p.patient_id "
            + ") max_dts "
            + "inner join encounter e on max_dts.patient_id=e.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dts.max_datadts=obs.obs_datetime and obs.concept_id=23888 and obs.voided=0 and obs.value_coded=1267 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 ) "
            + ") dispensa_semestral "
            + "inner join ( "
            + "Select p.patient_id,max(o.obs_datetime) data_carga from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on e.encounter_id=o.encounter_id "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and "
            + "e.encounter_type = 6 and  o.concept_id in (856,1305) and  o.obs_datetime <= :endDate and e.location_id=:location group by p.patient_id) carga_viral on dispensa_semestral.patient_id=carga_viral.patient_id "
            + "where dispensa_semestral.max_datatl between date_add(carga_viral.data_carga, interval -12 MONTH) and carga_viral.data_carga ";

    public static final String findPatientsWhoAreFastTrack =
        "select fluxo_rapido.patient_id from( "
            + "select patient_id,max_datafr from( "
            + "select max_fr.patient_id,max_datafr from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datafr from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23729 and e.location_id=:location and o.obs_datetime<=:endDate "
            + "group by p.patient_id "
            + ") max_fr "
            + "inner join encounter e on e.patient_id=max_fr.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where  max_fr.max_datafr=obs.obs_datetime and obs.concept_id=23729 and obs.value_coded in (1256,1257) and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") fr "
            + "where patient_id not in ( "
            + "select max_fr.patient_id from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datafr from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23729 and e.location_id=:location and o.obs_datetime<=:endDate group by p.patient_id "
            + ") max_fr "
            + "inner join encounter e on e.patient_id=max_fr.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_fr.max_datafr=obs.obs_datetime and obs.concept_id=23729 and obs.value_coded=1267 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ")) fluxo_rapido "
            + "inner join ( "
            + "Select p.patient_id,max(o.obs_datetime) data_carga from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on e.encounter_id=o.encounter_id "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and "
            + "e.encounter_type = 6 and  o.concept_id in (856,1305) and  o.obs_datetime <= :endDate and e.location_id=:location group by p.patient_id) carga_viral on fluxo_rapido.patient_id=carga_viral.patient_id "
            + "where fluxo_rapido.max_datafr between date_add(carga_viral.data_carga, interval -12 MONTH) and carga_viral.data_carga ";

    public static final String findPatientsWhoAreInCommunitaryDispenseViaAPE =
        "select dispensa_comunitaria_ape.patient_id from ( "
            + "select dispensa_comunitaria.patient_id,max_datadc from ( "
            + "SELECT max_dc.patient_id,max_datadc from  ( "
            + "SELECT p.patient_id,max(o.obs_datetime) max_datadc from patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "INNER JOIN obs o on o.encounter_id=e.encounter_id "
            + "WHERE e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 "
            + "and o.concept_id=23731 and e.location_id=:location and o.obs_datetime<=:endDate group by p.patient_id "
            + ") max_dc "
            + "inner join encounter e on e.patient_id=max_dc.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dc.max_datadc=obs.obs_datetime and obs.concept_id=23731 and obs.value_coded in (1256,1257) and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") dispensa_comunitaria "
            + "inner join encounter e on e.patient_id=dispensa_comunitaria.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where dispensa_comunitaria.max_datadc=obs.obs_datetime and obs.concept_id=165174 and obs.voided=0 and obs.value_coded = 165179 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") dispensa_comunitaria_ape "
            + "inner join ( "
            + "Select p.patient_id,max(o.obs_datetime) data_carga from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on e.encounter_id=o.encounter_id "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and "
            + "e.encounter_type = 6 and  o.concept_id in (856,1305) and  o.obs_datetime <= :endDate and e.location_id=:location group by p.patient_id) carga_viral on dispensa_comunitaria_ape.patient_id=carga_viral.patient_id "
            + "where dispensa_comunitaria_ape.max_datadc between date_add(carga_viral.data_carga, interval -12 MONTH) and carga_viral.data_carga ";
  }
}
