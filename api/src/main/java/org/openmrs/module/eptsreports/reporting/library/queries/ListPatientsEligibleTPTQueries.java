package org.openmrs.module.eptsreports.reporting.library.queries;

public interface ListPatientsEligibleTPTQueries {

  class QUERY {

    public static final String findPatientsWhoInitiatedIPTInLast7Months =
        "																"
            + "select distinct inicio_ipt.patient_id from 								"
            + "(	 																		"
            + "	select p.patient_id, o.value_datetime data_inicio_ipt 					"
            + "		from patient p 														"
            + "			inner join encounter e on p.patient_id=e.patient_id 			"
            + "			inner join obs o on o.encounter_id=e.encounter_id 				"
            + "		where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128 "
            + "			and o.value_datetime between :endDate - INTERVAL 210 DAY and  :endDate and e.location_id=:location "
            + "	union 																	"
            + "	select p.patient_id, e.encounter_datetime data_inicio_ipt 				"
            + "		from	patient p 													"
            + "			inner join encounter e on p.patient_id=e.patient_id 			"
            + "			inner join obs o on o.encounter_id=e.encounter_id 				"
            + "		where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256 "
            + "			and e.encounter_datetime between :endDate - INTERVAL 210 DAY and  :endDate and e.location_id=:location "
            + "	union 																	"
            + "	select inicio_ipt.patient_id,data_inicio_ipt from 						"
            + "	( 																		"
            + "		select first_tpt_pick_up.patient_id,data_inicio_ipt from  			"
            + "		(	 																"
            + "			select p.patient_id, min(e.encounter_datetime) data_inicio_ipt  "
            + "				from patient p 												"
            + "					inner join encounter e on p.patient_id=e.patient_id 	"
            + "					inner join obs o on o.encounter_id=e.encounter_id 		"
            + "				where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985 and o.value_coded is not null and e.encounter_type=60 "
            + "					and e.encounter_datetime between :endDate - INTERVAL 210 DAY and  :endDate and e.location_id=:location	 "
            + "				group by p.patient_id 										"
            + "		) first_tpt_pick_up 												"
            + "			inner join encounter e on e.patient_id = first_tpt_pick_up.patient_id "
            + "			inner join obs o on o.encounter_id=e.encounter_id	 			"
            + "		where e.voided =0 and e.encounter_type = 60 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982)  "
            + "			and e.encounter_datetime = first_tpt_pick_up.data_inicio_ipt 	"
            + "		group by first_tpt_pick_up.patient_id 								"
            + "	) inicio_ipt 															"
            + "	left join 																"
            + "	( 																		"
            + "		 select p.patient_id, e.encounter_datetime data_anterior_ipt 		"
            + "	 		from patient p 													"
            + "				inner join encounter e on p.patient_id=e.patient_id 		"
            + "				inner join obs o on o.encounter_id=e.encounter_id 			"
            + "			where e.voided=0 and p.voided=0 and o.voided=0 and o.concept_id=23985  and o.value_coded in (656,23982)  and e.encounter_type=60 "
            + "				and e.encounter_datetime <= :endDate  and e.location_id=:location	 "
            + "	) inicio_anterior_ipt on inicio_ipt.patient_id = inicio_anterior_ipt.patient_id  "
            + "	  	and inicio_anterior_ipt.data_anterior_ipt between (inicio_ipt.data_inicio_ipt - INTERVAL 7 MONTH) and (inicio_ipt.data_inicio_ipt - INTERVAL 1 day) "
            + "	 where inicio_anterior_ipt.patient_id is null 							"
            + ") inicio_ipt 															";

    public static final String findIPTPatientsStartDates =
        "                            "
            + "select distinct inicio_ipt.patient_id from  								"
            + "(	  																	"
            + "	select p.patient_id, o.value_datetime data_inicio_ipt  					"
            + "		from patient p  													"
            + "			inner join encounter e on p.patient_id=e.patient_id  			"
            + "			inner join obs o on o.encounter_id=e.encounter_id  				"
            + "		where  p.voided=0 and  e.voided=0 and o.voided=0 and e.encounter_type in (6,9,53) and o.concept_id=6128  "
            + "			and o.value_datetime <= :endDate and e.location_id=:location  	"
            + "	union  																	"
            + "	select p.patient_id, e.encounter_datetime data_inicio_ipt  				"
            + "		from	patient p  													"
            + "			inner join encounter e on p.patient_id=e.patient_id  			"
            + "			inner join obs o on o.encounter_id=e.encounter_id  				"
            + "		where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9)  and o.concept_id=6122 and o.value_coded=1256  "
            + "			and e.encounter_datetime <=  :endDate and e.location_id=:location  "
            + "	union  																	"
            + "	select p.patient_id, e.encounter_datetime data_inicio_ipt   			"
            + "		from patient p  													"
            + "			inner join encounter e on p.patient_id=e.patient_id  			"
            + "			inner join obs o on o.encounter_id=e.encounter_id  				"
            + "		where p.voided=0 and e.voided =0 and e.encounter_type = 60 and o.voided=0 and o.concept_id=23985 and o.value_coded in (656,23982)  "
            + "			and e.encounter_datetime <= :endDate and e.location_id=:location "
            + ") inicio_ipt 															";

    public static String findPatientsWhoInitiated3HPTherapyInLast4Months =
        "                                 "
            + "select patient_id from                                                                        "
            + "(                                                                                             "
            + "      select 3HP.patient_id, 3HP.data_inicio_3HP from                                         "
            + "      (                                                                                       "
            + "            select p.patient_id, e.encounter_datetime data_inicio_3HP                         "
            + "                  from  patient p                                                             "
            + "                        inner join encounter e on p.patient_id=e.patient_id                   "
            + "                        inner join obs o on o.encounter_id=e.encounter_id                     "
            + "                  where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9) and o.concept_id=1719 and o.value_coded=23954 "
            + "                        and e.encounter_datetime between :endDate - INTERVAL 120 DAY and  :endDate  and e.location_id=:location "
            + "      ) 3HP                                                                                    "
            + "      left join                                                                                "
            + "      (                                                                                        "
            + "            select p.patient_id, e.encounter_datetime data_anterior_inicio_3HP                 "
            + "                  from  patient p                                                              "
            + "                        inner join encounter e on p.patient_id=e.patient_id                    "
            + "                        inner join obs o on o.encounter_id=e.encounter_id                      "
            + "                  where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9) and o.concept_id=1719 and o.value_coded=23954 "
            + "                        and e.encounter_datetime <= :endDate  and e.location_id=:location      "
            + "      ) 3HP_anterior on 3HP.patient_id = 3HP_anterior.patient_id                               "
            + "            and 3HP_anterior.data_anterior_inicio_3HP between 3HP.data_inicio_3HP - INTERVAL 4 MONTH and 3HP.data_inicio_3HP  - INTERVAL 1 DAY "
            + "      where 3HP_anterior.patient_id is null                                                    "
            + "      union                                                                                    "
            + "      select 3HP.patient_id, 3HP.data_inicio_3HP from                                          "
            + "      (                                                                                        "
            + "            select 3HP_firstPickUp.patient_id, 3HP_firstPickUp.data_inicio_3HP from            "
            + "            (                                                                                  "
            + "                  select p.patient_id, min(e.encounter_datetime) data_inicio_3HP               "
            + "                        from  patient p                                                        "
            + "                              inner join encounter e on p.patient_id=e.patient_id              "
            + "                              inner join obs o on o.encounter_id=e.encounter_id                "
            + "                        where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=60 and o.concept_id=23985 and o.value_coded is not null "
            + "                              and   e.encounter_datetime between :endDate  - INTERVAL 120 DAY and  :endDate  and e.location_id=:location            "
            + "                        group by p.patient_id                                                  "
            + "            ) 3HP_firstPickUp                                                                  "
            + "                  inner join encounter e on e.patient_id = 3HP_firstPickUp.patient_id          "
            + "                  inner join obs o on o.encounter_id = e.encounter_datetime                    "
            + "            where e.voided = 0 and e.encounter_type = 60 and o.concept_id=23985 and o.value_coded in (23954,23984) "
            + "                  and 3HP_firstPickUp.data_inicio_3HP = e.encounter_datetime                   "
            + "            group by 3HP_firstPickUp.patient_id                                                "
            + "      ) 3HP                                                                                    "
            + "      left join                                                                                "
            + "      (                                                                                        "
            + "            select p.patient_id, e.encounter_datetime data_anterior_inicio_3HP                 "
            + "                  from  patient p                                                              "
            + "                        inner join encounter e on p.patient_id=e.patient_id                    "
            + "                        inner join obs o on o.encounter_id=e.encounter_id                      "
            + "                  where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=60  and o.concept_id=23985 and o.value_coded in (23954,23984) "
            + "                        and   e.encounter_datetime <=  :endDate  and e.location_id=:location   "
            + "      )3HP_anterior on 3HP.patient_id = 3HP_anterior.patient_id                                "
            + "            and 3HP_anterior.data_anterior_inicio_3HP between 3HP.data_inicio_3HP - INTERVAL 4 MONTH and 3HP.data_inicio_3HP  - INTERVAL 1 DAY "
            + "      where 3HP_anterior.patient_id is null                                                    "
            + ") inicio_3HP                                                                                   ";

    public static final String find3HPPatientsStartDates =
        "                                              "
            + "select Inicio3HP.patient_id, Inicio3HP.data_inicio_3HP from 																			"
            + "( 																																	"
            + "	select p.patient_id, e.encounter_datetime data_inicio_3HP																			"
            + "		from	patient p																												"
            + "			inner join encounter e on p.patient_id=e.patient_id																			"
            + "			inner join obs o on o.encounter_id=e.encounter_id																			"
            + "		where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type in (6,9) and o.concept_id=1719 and o.value_coded=23954 		"
            + "			and e.encounter_datetime <= :endDate  and e.location_id=:location 															"
            + "	union 																																"
            + "	select p.patient_id, e.encounter_datetime data_inicio_3HP																			"
            + "		from	patient p																												"
            + "			inner join encounter e on p.patient_id=e.patient_id																			"
            + "			inner join obs o on o.encounter_id=e.encounter_id																			"
            + "		where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=60  and o.concept_id=23985 and o.value_coded in (23954,23984) "
            + "			and	e.encounter_datetime <=  :endDate  and e.location_id=:location															"
            + ") Inicio3HP 																															";
  }
}
